{"version":3,"sources":["../../../../app/playground/page.tsx","../../../../app/components/Tooltip.tsx","../../../../features/smart-compression.ts","../../../../features/security.ts","../../../../features/variable-system.ts","../../../../features/cost-calculator.ts","../../../../app/components/AIAgentHelper.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback, Suspense } from 'react';\nimport Link from 'next/link';\nimport { useSearchParams } from 'next/navigation';\nimport { Icons, Icon } from '../components/Icons';\nimport { Tooltip, HelpTooltip } from '../components/Tooltip';\nimport { ALL_TEMPLATES, TEMPLATE_CATEGORIES, PromptTemplate, getTemplatesByCategory } from '../components/PromptTemplates';\nimport { compressPrompt } from '@/features/smart-compression';\nimport { detectPII, redactPII, detectInjection, getInjectionRiskLevel } from '@/features/security';\nimport { extractVariables, substituteVariables } from '@/features/variable-system';\nimport { calculateCost, MODEL_PRICING } from '@/features/cost-calculator';\nimport AIAgentHelper from '../components/AIAgentHelper';\nimport Walkthrough from '../components/ui/Walkthrough';\nimport HelpButton from '../components/ui/HelpButton';\nimport { PLAYGROUND_WALKTHROUGH } from '../data/walkthrough-steps';\nimport { ThemeToggle } from '../components/ThemeToggle';\n\n// Loading fallback component\nfunction PlaygroundLoading() {\n  return (\n    <div className=\"min-h-screen bg-[var(--background)] flex items-center justify-center\">\n      <div className=\"text-center\">\n        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-[#4ECDC4] to-[#3EB489] flex items-center justify-center mx-auto mb-4 animate-pulse\">\n          <Icons.chart className=\"w-7 h-7 text-[#0a1929]\" />\n        </div>\n        <p className=\"text-[var(--text-secondary)]\">Loading builder...</p>\n      </div>\n    </div>\n  );\n}\n\n// Main export wrapped in Suspense\nexport default function PlaygroundPage() {\n  return (\n    <Suspense fallback={<PlaygroundLoading />}>\n      <Playground />\n    </Suspense>\n  );\n}\n\ntype Mode = 'simple' | 'expert';\ntype Step = 'template' | 'customize' | 'export';\n\n// Industry/use-case options for finance professionals\nconst INDUSTRY_OPTIONS = [\n  {\n    id: 'ma',\n    name: 'M&A & Deal Work',\n    description: 'Investment memos, term sheets, due diligence',\n    icon: 'handshake',\n    color: '#4ECDC4',\n    categories: ['ma'],\n  },\n  {\n    id: 'research',\n    name: 'Investment Research',\n    description: 'Due diligence, competitive intel, sector analysis',\n    icon: 'search',\n    color: '#14b8a6',\n    categories: ['research'],\n  },\n  {\n    id: 'strategy',\n    name: 'Strategy & Planning',\n    description: 'SWOT analysis, business plans, OKRs',\n    icon: 'target',\n    color: '#8b5cf6',\n    categories: ['strategy'],\n  },\n  {\n    id: 'reporting',\n    name: 'Professional Reporting',\n    description: 'Board decks, investor updates, executive summaries',\n    icon: 'presentation',\n    color: '#f97316',\n    categories: ['reporting'],\n  },\n  {\n    id: 'analysis',\n    name: 'Financial Analysis',\n    description: 'DCF, comps, earnings analysis, sensitivity',\n    icon: 'chart',\n    color: '#059669',\n    categories: ['analysis'],\n  },\n  {\n    id: 'senior-housing',\n    name: 'Senior Housing',\n    description: 'SNF, ALF, ILF pro forma analysis',\n    icon: 'home',\n    color: '#10b981',\n    categories: ['senior-housing'],\n  },\n];\n\n// Export format options\nconst EXPORT_FORMATS = [\n  { id: 'copy', name: 'Copy to Clipboard', icon: 'copy', description: 'Copy prompt text' },\n  { id: 'excel', name: 'Excel-Ready', icon: 'spreadsheet', description: 'Formatted for spreadsheets' },\n  { id: 'powerpoint', name: 'PowerPoint-Ready', icon: 'presentation', description: 'Slide-friendly format' },\n  { id: 'memo', name: 'Memo Format', icon: 'document', description: 'Professional document' },\n  { id: 'pdf', name: 'PDF Export', icon: 'documentChart', description: 'Download as PDF' },\n];\n\n// Model recommendations based on complexity\nconst MODEL_RECOMMENDATIONS = {\n  beginner: { model: 'claude-3-5-haiku-20241022', reason: 'Fast and cost-effective for simple tasks' },\n  intermediate: { model: 'claude-sonnet-4-20250514', reason: 'Balanced performance for standard analysis' },\n  advanced: { model: 'claude-opus-4-5-20250514', reason: 'Maximum capability for complex financial modeling' },\n};\n\n// Demo data for one-click example\nconst DEMO_EXAMPLE = {\n  templateId: 'dcf-model',\n  variables: {\n    company_name: 'Acme Corporation',\n    revenue: '150,000,000',\n    growth_rate: '12',\n    discount_rate: '10',\n    terminal_growth: '2.5',\n    projection_years: '5',\n  },\n};\n\nfunction Playground() {\n  const searchParams = useSearchParams();\n\n  // Core state\n  const [mode, setMode] = useState<Mode>('simple');\n  const [currentStep, setCurrentStep] = useState<Step>('template');\n  const [prompt, setPrompt] = useState('');\n  const [originalPrompt, setOriginalPrompt] = useState('');\n\n  // Industry & Template state\n  const [selectedIndustry, setSelectedIndustry] = useState<string | null>(null);\n  const [selectedTemplate, setSelectedTemplate] = useState<PromptTemplate | null>(null);\n  const [selectedCategory, setSelectedCategory] = useState('all');\n  const [variableValues, setVariableValues] = useState<Record<string, string>>({});\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // Export state\n  const [selectedExportFormat, setSelectedExportFormat] = useState('copy');\n  const [auditMode, setAuditMode] = useState(false);\n\n  // Analysis state\n  const [analysisResults, setAnalysisResults] = useState<{\n    tokens: number;\n    cost: number;\n    piiCount: number;\n    injectionRisk: string;\n    compressionSavings: number;\n  } | null>(null);\n\n  // UI state\n  const [copied, setCopied] = useState(false);\n  const [showHistory, setShowHistory] = useState(false);\n  const [history, setHistory] = useState<string[]>([]);\n  const [selectedModel, setSelectedModel] = useState('claude-sonnet-4-20250514');\n  const [showAgentHelper, setShowAgentHelper] = useState(false);\n  const [showWalkthrough, setShowWalkthrough] = useState(false);\n\n  // Handle URL parameters for direct template access\n  useEffect(() => {\n    const templateId = searchParams.get('template');\n    const modeParam = searchParams.get('mode');\n\n    if (modeParam === 'expert') {\n      setMode('expert');\n    }\n\n    if (templateId) {\n      const template = ALL_TEMPLATES.find(t => t.id === templateId);\n      if (template) {\n        handleSelectTemplate(template);\n      }\n    }\n  }, [searchParams]);\n\n  // Load history from localStorage\n  useEffect(() => {\n    const saved = localStorage.getItem('promptforge-history');\n    if (saved) {\n      setHistory(JSON.parse(saved));\n    }\n  }, []);\n\n  // Check if user has seen walkthrough\n  useEffect(() => {\n    const hasSeenTour = localStorage.getItem('promptforge-playground-tour');\n    if (!hasSeenTour) {\n      const timer = setTimeout(() => setShowWalkthrough(true), 500);\n      return () => clearTimeout(timer);\n    }\n  }, []);\n\n  // Analyze prompt whenever it changes\n  useEffect(() => {\n    if (prompt.length > 10) {\n      const cost = calculateCost(prompt, 500, selectedModel);\n      const pii = detectPII(prompt);\n      const compression = compressPrompt(prompt);\n      const riskLevel = getInjectionRiskLevel(prompt);\n\n      setAnalysisResults({\n        tokens: cost.inputTokens,\n        cost: cost.totalCost,\n        piiCount: pii.length,\n        injectionRisk: riskLevel,\n        compressionSavings: compression.savings,\n      });\n    } else {\n      setAnalysisResults(null);\n    }\n  }, [prompt, selectedModel]);\n\n  // Update model recommendation based on template difficulty\n  useEffect(() => {\n    if (selectedTemplate) {\n      const recommendation = MODEL_RECOMMENDATIONS[selectedTemplate.difficulty];\n      if (recommendation) {\n        setSelectedModel(recommendation.model);\n      }\n    }\n  }, [selectedTemplate]);\n\n  // Handle industry selection (filter templates, stay on same step)\n  const handleSelectIndustry = (industryId: string) => {\n    if (selectedIndustry === industryId) {\n      // Toggle off if same industry clicked\n      setSelectedIndustry(null);\n      setSelectedCategory('all');\n    } else {\n      setSelectedIndustry(industryId);\n      const industry = INDUSTRY_OPTIONS.find(i => i.id === industryId);\n      if (industry && industry.categories.length > 0) {\n        setSelectedCategory(industry.categories[0]);\n      }\n    }\n  };\n\n  // One-click demo - instantly show a completed example\n  const handleTryDemo = () => {\n    const template = ALL_TEMPLATES.find(t => t.id === DEMO_EXAMPLE.templateId);\n    if (template) {\n      setSelectedTemplate(template);\n      setPrompt(template.prompt);\n      setOriginalPrompt(template.prompt);\n      setVariableValues(DEMO_EXAMPLE.variables);\n      setCurrentStep('export'); // Jump straight to the result\n    }\n  };\n\n  // Handle template selection\n  const handleSelectTemplate = (template: PromptTemplate) => {\n    setSelectedTemplate(template);\n    setPrompt(template.prompt);\n    setOriginalPrompt(template.prompt);\n\n    // Initialize variable values with defaults\n    const defaults: Record<string, string> = {};\n    template.variables.forEach(v => {\n      defaults[v.name] = v.default;\n    });\n    setVariableValues(defaults);\n\n    setCurrentStep('customize');\n  };\n\n  // Handle variable change\n  const handleVariableChange = (name: string, value: string) => {\n    setVariableValues(prev => ({ ...prev, [name]: value }));\n  };\n\n  // Generate final prompt\n  const generatePrompt = useCallback(() => {\n    if (!selectedTemplate) return prompt;\n    return substituteVariables(selectedTemplate.prompt, variableValues);\n  }, [selectedTemplate, variableValues, prompt]);\n\n  // Format prompt for export\n  const formatPromptForExport = (format: string) => {\n    const finalPrompt = mode === 'simple' ? generatePrompt() : prompt;\n\n    switch (format) {\n      case 'excel':\n        // Add markdown table formatting hints\n        return `=== EXCEL-READY FORMAT ===\\n\\n${finalPrompt}\\n\\n=== OUTPUT INSTRUCTIONS ===\\nPlease format all numerical data in tables with:\\n- Column headers in Row 1\\n- Currency values with $ symbol and 2 decimal places\\n- Percentages with % symbol and 1 decimal place\\n- Dates in YYYY-MM-DD format`;\n\n      case 'powerpoint':\n        // Add slide-friendly formatting\n        return `=== PRESENTATION FORMAT ===\\n\\n${finalPrompt}\\n\\n=== OUTPUT INSTRUCTIONS ===\\nPlease format output as:\\n- Bullet points (max 5-7 per section)\\n- Clear section headers\\n- Key metrics highlighted\\n- Executive summary at the top`;\n\n      case 'memo':\n        // Professional memo format\n        const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });\n        return `=== MEMO FORMAT ===\\nDate: ${today}\\nRe: ${selectedTemplate?.name || 'Analysis'}\\n\\n${finalPrompt}\\n\\n=== OUTPUT INSTRUCTIONS ===\\nPlease structure the response as a professional memo with:\\n- Executive Summary\\n- Key Findings\\n- Detailed Analysis\\n- Recommendations\\n- Appendix (if applicable)`;\n\n      case 'pdf':\n      case 'copy':\n      default:\n        return finalPrompt;\n    }\n  };\n\n  // Copy to clipboard\n  const handleCopy = async () => {\n    const finalPrompt = formatPromptForExport(selectedExportFormat);\n    await navigator.clipboard.writeText(finalPrompt);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n\n    // Save to history\n    const newHistory = [finalPrompt, ...history.slice(0, 9)];\n    setHistory(newHistory);\n    localStorage.setItem('promptforge-history', JSON.stringify(newHistory));\n\n    // Log audit trail if enabled\n    if (auditMode) {\n      const auditEntry = {\n        timestamp: new Date().toISOString(),\n        template: selectedTemplate?.name || 'Custom',\n        format: selectedExportFormat,\n        tokens: analysisResults?.tokens || 0,\n        cost: analysisResults?.cost || 0,\n      };\n      console.log('Audit Log:', auditEntry);\n    }\n  };\n\n  // Optimize prompt\n  const handleOptimize = () => {\n    const currentPrompt = mode === 'simple' ? generatePrompt() : prompt;\n    const result = compressPrompt(currentPrompt, { aggressiveness: 'medium' });\n    setPrompt(result.compressed);\n  };\n\n  // Security scan\n  const handleSecurityScan = () => {\n    const currentPrompt = mode === 'simple' ? generatePrompt() : prompt;\n    const { redacted } = redactPII(currentPrompt);\n    setPrompt(redacted);\n  };\n\n  // Get templates for current category/industry\n  const filteredTemplates = ALL_TEMPLATES.filter(t => {\n    const matchesCategory = selectedCategory === 'all' || t.category === selectedCategory || t.categorySlug === selectedCategory;\n    const matchesSearch = searchQuery === '' ||\n      t.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      t.description.toLowerCase().includes(searchQuery.toLowerCase());\n    return matchesCategory && matchesSearch;\n  });\n\n  // Steps for simple mode - Simplified to 3 steps\n  const steps: { id: Step; name: string; icon: keyof typeof Icons }[] = [\n    { id: 'template', name: 'Choose Template', icon: 'documentChart' },\n    { id: 'customize', name: 'Fill Details', icon: 'wand' },\n    { id: 'export', name: 'Get Prompt', icon: 'copy' },\n  ];\n\n  const currentStepIndex = steps.findIndex(s => s.id === currentStep);\n\n  // Render variable input based on type\n  const renderVariableInput = (variable: { name: string; description: string; default: string; type?: string }) => {\n    const type = variable.type || 'text';\n    const commonClasses = \"input\";\n\n    switch (type) {\n      case 'currency':\n        return (\n          <div className=\"relative\">\n            <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-[var(--text-muted)]\">$</span>\n            <input\n              type=\"text\"\n              value={variableValues[variable.name] || ''}\n              onChange={(e) => handleVariableChange(variable.name, e.target.value)}\n              className={`${commonClasses} pl-8 tabular-nums`}\n              placeholder={variable.default || '0.00'}\n            />\n          </div>\n        );\n\n      case 'percentage':\n        return (\n          <div className=\"relative\">\n            <input\n              type=\"text\"\n              value={variableValues[variable.name] || ''}\n              onChange={(e) => handleVariableChange(variable.name, e.target.value)}\n              className={`${commonClasses} pr-8 tabular-nums`}\n              placeholder={variable.default || '0'}\n            />\n            <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--text-muted)]\">%</span>\n          </div>\n        );\n\n      case 'number':\n        return (\n          <input\n            type=\"number\"\n            value={variableValues[variable.name] || ''}\n            onChange={(e) => handleVariableChange(variable.name, e.target.value)}\n            className={`${commonClasses} tabular-nums`}\n            placeholder={variable.default || '0'}\n          />\n        );\n\n      case 'date':\n        return (\n          <input\n            type=\"date\"\n            value={variableValues[variable.name] || ''}\n            onChange={(e) => handleVariableChange(variable.name, e.target.value)}\n            className={commonClasses}\n          />\n        );\n\n      case 'select':\n        const options = variable.default.split(',').map(o => o.trim());\n        return (\n          <select\n            value={variableValues[variable.name] || options[0]}\n            onChange={(e) => handleVariableChange(variable.name, e.target.value)}\n            className={commonClasses}\n          >\n            {options.map(opt => (\n              <option key={opt} value={opt}>{opt}</option>\n            ))}\n          </select>\n        );\n\n      case 'textarea':\n        return (\n          <textarea\n            value={variableValues[variable.name] || ''}\n            onChange={(e) => handleVariableChange(variable.name, e.target.value)}\n            className={`${commonClasses} h-32 resize-none font-mono text-sm`}\n            placeholder={variable.description}\n          />\n        );\n\n      default:\n        return (\n          <input\n            type=\"text\"\n            value={variableValues[variable.name] || ''}\n            onChange={(e) => handleVariableChange(variable.name, e.target.value)}\n            className={commonClasses}\n            placeholder={variable.default || variable.description}\n          />\n        );\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-[var(--background)]\">\n      {/* Background */}\n      <div className=\"fixed inset-0 bg-gradient-mesh pointer-events-none opacity-30\" />\n\n      {/* Header */}\n      <header className=\"relative z-10 border-b border-[var(--border-color)]\">\n        <div className=\"max-w-7xl mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            {/* Logo */}\n            <Link href=\"/\" className=\"flex items-center gap-3 hover:opacity-80 transition-opacity\">\n              <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-[#4ECDC4] to-[#3EB489] flex items-center justify-center\">\n                <Icons.chart className=\"w-6 h-6 text-[#0a1929]\" />\n              </div>\n              <div>\n                <span className=\"text-xl font-bold\">\n                  <span className=\"text-[#4ECDC4]\">Prompt</span>\n                  <span className=\"text-[var(--foreground)]\">Forge</span>\n                </span>\n                <span className=\"ml-2 text-xs px-2 py-0.5 bg-[rgba(78,205,196,0.2)] text-[#4ECDC4] rounded-full\">\n                  {mode === 'simple' ? 'Simple' : 'Expert'}\n                </span>\n              </div>\n            </Link>\n\n            {/* Mode Toggle */}\n            <div className=\"flex items-center gap-4\">\n              <div className=\"flex bg-[var(--card)] rounded-xl p-1 border border-[var(--border-color)]\" data-tour=\"mode-toggle\">\n                <button\n                  onClick={() => setMode('simple')}\n                  className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n                    mode === 'simple'\n                      ? 'bg-[#4ECDC4] text-[#0a1929]'\n                      : 'text-[var(--text-secondary)] hover:text-[var(--foreground)]'\n                  }`}\n                >\n                  <Icons.wand className=\"w-4 h-4 inline mr-2\" />\n                  Simple\n                </button>\n                <button\n                  onClick={() => setMode('expert')}\n                  className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n                    mode === 'expert'\n                      ? 'bg-[#4ECDC4] text-[#0a1929]'\n                      : 'text-[var(--text-secondary)] hover:text-[var(--foreground)]'\n                  }`}\n                >\n                  <Icons.beaker className=\"w-4 h-4 inline mr-2\" />\n                  Expert\n                </button>\n              </div>\n\n              <button\n                onClick={() => setShowAgentHelper(!showAgentHelper)}\n                className={`p-2 transition-colors ${showAgentHelper ? 'text-[#4ECDC4]' : 'text-[var(--text-muted)] hover:text-[#4ECDC4]'}`}\n                title=\"AI Assistant\"\n              >\n                <Icons.bot className=\"w-5 h-5\" />\n              </button>\n              <button\n                onClick={() => setShowHistory(!showHistory)}\n                className=\"p-2 text-[var(--text-muted)] hover:text-[#4ECDC4] transition-colors\"\n              >\n                <Icons.history className=\"w-5 h-5\" />\n              </button>\n              <ThemeToggle />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"relative z-10 max-w-7xl mx-auto px-6 py-8\">\n        {/* Simple Mode */}\n        {mode === 'simple' && (\n          <div className=\"space-y-8\">\n            {/* Progress Steps */}\n            <div className=\"flex items-center justify-center gap-2 overflow-x-auto pb-2\">\n              {steps.map((step, index) => {\n                const StepIcon = Icons[step.icon];\n                return (\n                  <div key={step.id} className=\"flex items-center\">\n                    <button\n                      onClick={() => index <= currentStepIndex && setCurrentStep(step.id)}\n                      disabled={index > currentStepIndex}\n                      className={`flex items-center gap-2 px-4 py-2 rounded-xl transition-all ${\n                        step.id === currentStep\n                          ? 'bg-[#4ECDC4] text-[#0a1929]'\n                          : index < currentStepIndex\n                          ? 'bg-[rgba(78,205,196,0.2)] text-[#4ECDC4] hover:bg-[rgba(78,205,196,0.3)]'\n                          : 'bg-[var(--card)] text-[var(--text-muted)] border border-[var(--border-color)]'\n                      }`}\n                    >\n                      <span className=\"w-6 h-6 rounded-full bg-current/20 flex items-center justify-center text-sm\">\n                        {index + 1}\n                      </span>\n                      <span className=\"hidden sm:inline\">{step.name}</span>\n                    </button>\n                    {index < steps.length - 1 && (\n                      <Icons.chevronRight className=\"w-4 h-4 text-[#334155] mx-2\" />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Step Content */}\n            <div className=\"animate-fade-in\">\n              {/* Step 1: Choose Template (combined industry + template) */}\n              {currentStep === 'template' && (\n                <div className=\"space-y-6\">\n                  <div className=\"text-center\">\n                    <h2 className=\"text-2xl font-bold text-[var(--foreground)] mb-2\">Choose Your Template</h2>\n                    <p className=\"text-[var(--text-secondary)]\">Filter by domain or browse all templates</p>\n\n                    {/* One-Click Demo */}\n                    <button\n                      onClick={handleTryDemo}\n                      className=\"mt-4 inline-flex items-center gap-2 px-5 py-2.5 rounded-xl bg-gradient-to-r from-[#4ECDC4] to-[#3EB489] text-[#0a1929] font-medium hover:opacity-90 transition-opacity\"\n                    >\n                      <Icons.play className=\"w-4 h-4\" />\n                      Try Demo Instantly\n                    </button>\n                    <p className=\"text-xs text-[var(--text-muted)] mt-2\">See a complete DCF analysis example in one click</p>\n                  </div>\n\n                  {/* Industry Quick Filters */}\n                  <div className=\"flex flex-wrap justify-center gap-2\">\n                    <button\n                      onClick={() => {\n                        setSelectedIndustry(null);\n                        setSelectedCategory('all');\n                      }}\n                      className={`px-4 py-2 rounded-xl text-sm transition-all flex items-center gap-2 ${\n                        !selectedIndustry\n                          ? 'bg-[#4ECDC4] text-[#0a1929]'\n                          : 'bg-[var(--card)] text-[var(--text-secondary)] hover:text-[var(--foreground)] border border-[var(--border-color)]'\n                      }`}\n                    >\n                      <Icons.search className=\"w-4 h-4\" />\n                      All Templates\n                    </button>\n                    {INDUSTRY_OPTIONS.map((industry) => {\n                      const IndustryIcon = Icons[industry.icon as keyof typeof Icons];\n                      return (\n                        <button\n                          key={industry.id}\n                          onClick={() => handleSelectIndustry(industry.id)}\n                          className={`px-4 py-2 rounded-xl text-sm transition-all flex items-center gap-2 ${\n                            selectedIndustry === industry.id\n                              ? 'bg-[#4ECDC4] text-[#0a1929]'\n                              : 'bg-[var(--card)] text-[var(--text-secondary)] hover:text-[var(--foreground)] border border-[var(--border-color)]'\n                          }`}\n                        >\n                          {IndustryIcon && <IndustryIcon className=\"w-4 h-4\" />}\n                          {industry.name}\n                        </button>\n                      );\n                    })}\n                  </div>\n\n                  {/* Search */}\n                  <div className=\"flex justify-center\">\n                    <div className=\"relative w-full max-w-md\">\n                      <Icons.search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]\" />\n                      <input\n                        type=\"text\"\n                        placeholder=\"Search templates...\"\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                        className=\"w-full pl-10 pr-4 py-3 bg-[var(--card)] border border-[var(--border-color)] rounded-xl text-sm text-[var(--foreground)] placeholder-[#64748b] focus:border-[#4ECDC4] focus:outline-none\"\n                      />\n                    </div>\n                  </div>\n\n                  {/* Template Grid */}\n                  <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    {filteredTemplates.map(template => (\n                      <button\n                        key={template.id}\n                        onClick={() => handleSelectTemplate(template)}\n                        className=\"card p-5 text-left hover:border-[#4ECDC4] transition-all group\"\n                      >\n                        <div className=\"flex items-start gap-4\">\n                          <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-[#4ECDC4] to-[#3EB489] flex items-center justify-center text-2xl shrink-0\">\n                            {template.icon}\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <h3 className=\"font-semibold text-[var(--foreground)] group-hover:text-[#4ECDC4] transition-colors truncate\">\n                              {template.name}\n                            </h3>\n                            <p className=\"text-sm text-[var(--text-muted)] mt-1 line-clamp-2\">{template.description}</p>\n                            <div className=\"flex flex-wrap gap-1 mt-2\">\n                              <span className={`badge badge-${template.difficulty}`}>\n                                {template.difficulty}\n                              </span>\n                              <span className=\"text-xs text-[var(--text-muted)]\">{template.estimatedTime}</span>\n                              {template.outputFormats.includes('excel') && (\n                                <span className=\"badge badge-excel text-xs\">Excel</span>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      </button>\n                    ))}\n\n                    {/* Blank template option */}\n                    <button\n                      onClick={() => {\n                        setSelectedTemplate(null);\n                        setPrompt('');\n                        setCurrentStep('customize');\n                      }}\n                      className=\"card p-5 text-left hover:border-[#4ECDC4] transition-all group border-dashed\"\n                    >\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl border-2 border-dashed border-[#334155] flex items-center justify-center\">\n                          <Icons.plus className=\"w-6 h-6 text-[var(--text-muted)]\" />\n                        </div>\n                        <div>\n                          <h3 className=\"font-semibold text-[var(--foreground)] group-hover:text-[#4ECDC4] transition-colors\">\n                            Start from Scratch\n                          </h3>\n                          <p className=\"text-sm text-[var(--text-muted)] mt-1\">Write your own prompt</p>\n                        </div>\n                      </div>\n                    </button>\n                  </div>\n\n                  {filteredTemplates.length === 0 && searchQuery && (\n                    <div className=\"text-center py-8\">\n                      <Icons.search className=\"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3 opacity-50\" />\n                      <p className=\"text-[var(--text-secondary)]\">No templates found for \"{searchQuery}\"</p>\n                      <button\n                        onClick={() => setSearchQuery('')}\n                        className=\"text-[#4ECDC4] text-sm mt-2 hover:underline\"\n                      >\n                        Clear search\n                      </button>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Step 3: Customize */}\n              {currentStep === 'customize' && (\n                <div className=\"grid lg:grid-cols-2 gap-6\">\n                  {/* Left: Variables or Editor */}\n                  <div className=\"space-y-4\" data-tour=\"variables-panel\">\n                    <div className=\"flex items-center justify-between\">\n                      <h2 className=\"text-xl font-bold text-[var(--foreground)]\">\n                        {selectedTemplate ? 'Financial Details' : 'Write Your Prompt'}\n                      </h2>\n                      <HelpTooltip content=\"Fill in each field to customize your financial analysis prompt.\" />\n                    </div>\n\n                    {selectedTemplate ? (\n                      <div className=\"space-y-4\">\n                        {/* Template info card */}\n                        <div className=\"card p-4 bg-[rgba(78,205,196,0.1)] border-[rgba(78,205,196,0.2)]\">\n                          <div className=\"flex items-center gap-3\">\n                            <span className=\"text-2xl\">{selectedTemplate.icon}</span>\n                            <div>\n                              <h3 className=\"font-semibold text-[var(--foreground)]\">{selectedTemplate.name}</h3>\n                              <div className=\"flex gap-2 mt-1\">\n                                <span className={`badge badge-${selectedTemplate.difficulty}`}>\n                                  {selectedTemplate.difficulty}\n                                </span>\n                                <span className=\"text-xs text-[var(--text-secondary)]\">{selectedTemplate.estimatedTime}</span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Variable inputs */}\n                        {selectedTemplate.variables.map(variable => (\n                          <div key={variable.name} className=\"space-y-2\">\n                            <label className=\"flex items-center gap-2 text-sm font-medium text-[var(--text-secondary)]\">\n                              <span className=\"text-[#4ECDC4]\">{`{{${variable.name}}}`}</span>\n                              {variable.type && (\n                                <span className=\"text-xs px-1.5 py-0.5 bg-[#1e3a5f] rounded text-[var(--text-muted)]\">\n                                  {variable.type}\n                                </span>\n                              )}\n                              <HelpTooltip content={variable.description} />\n                            </label>\n                            {renderVariableInput(variable)}\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <textarea\n                        value={prompt}\n                        onChange={(e) => setPrompt(e.target.value)}\n                        className=\"input h-64 resize-none font-mono text-sm\"\n                        data-tour=\"prompt-editor\"\n                        placeholder=\"Write your financial analysis prompt here...\n\nTips for finance prompts:\n• Specify the company/asset being analyzed\n• Include relevant financial metrics\n• Define the analysis timeframe\n• Use {{variables}} for dynamic content\n• Request specific output formats (tables, charts)\"\n                      />\n                    )}\n\n                    <div className=\"flex gap-3\">\n                      <button\n                        onClick={() => setCurrentStep('template')}\n                        className=\"btn-secondary flex-1\"\n                      >\n                        <Icons.arrowLeft className=\"w-4 h-4 inline mr-2\" />\n                        Back\n                      </button>\n                      <button\n                        onClick={() => setCurrentStep('export')}\n                        disabled={selectedTemplate ? Object.values(variableValues).some(v => !v) : !prompt}\n                        className=\"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        Get My Prompt\n                        <Icons.arrowRight className=\"w-4 h-4 inline ml-2\" />\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Right: Preview */}\n                  <div className=\"space-y-4\" data-tour=\"output-panel\">\n                    <div className=\"flex items-center justify-between\">\n                      <h2 className=\"text-xl font-bold text-[var(--foreground)]\">Live Preview</h2>\n                      <div className=\"flex items-center gap-2 text-sm text-[var(--text-muted)]\">\n                        <Icons.eye className=\"w-4 h-4\" />\n                        Updates as you type\n                      </div>\n                    </div>\n\n                    <div className=\"card p-6 min-h-[300px]\">\n                      <pre className=\"whitespace-pre-wrap text-sm text-[var(--text-secondary)] font-mono\">\n                        {selectedTemplate ? generatePrompt() : prompt || 'Your prompt will appear here...'}\n                      </pre>\n                    </div>\n\n                    {/* Quick Stats */}\n                    {analysisResults && (\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"card p-4 text-center\">\n                          <div className=\"text-2xl font-bold text-[#4ECDC4] tabular-nums\">{analysisResults.tokens}</div>\n                          <div className=\"text-xs text-[var(--text-muted)]\">Tokens</div>\n                        </div>\n                        <div className=\"card p-4 text-center\">\n                          <div className=\"text-2xl font-bold text-[var(--foreground)] tabular-nums\">${analysisResults.cost.toFixed(4)}</div>\n                          <div className=\"text-xs text-[var(--text-muted)]\">Est. Cost</div>\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Model recommendation */}\n                    {selectedTemplate && (\n                      <div className=\"card p-4 bg-[rgba(20,184,166,0.1)] border-[rgba(20,184,166,0.2)]\">\n                        <div className=\"flex items-center gap-2 text-[#14b8a6] mb-2\">\n                          <Icons.lightbulb className=\"w-4 h-4\" />\n                          <span className=\"text-sm font-medium\">Recommended Model</span>\n                        </div>\n                        <p className=\"text-xs text-[var(--text-secondary)]\">\n                          {MODEL_RECOMMENDATIONS[selectedTemplate.difficulty].reason}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Step 3: Get Your Prompt (combined review + export) */}\n              {currentStep === 'export' && (\n                <div className=\"max-w-5xl mx-auto space-y-6\">\n                  <div className=\"text-center\">\n                    <h2 className=\"text-2xl font-bold text-[var(--foreground)] mb-2\">Your Prompt is Ready!</h2>\n                    <p className=\"text-[var(--text-secondary)]\">Review, optimize, and copy your prompt</p>\n                  </div>\n\n                  <div className=\"grid lg:grid-cols-3 gap-6\">\n                    {/* Main Content - Prompt Preview */}\n                    <div className=\"lg:col-span-2 space-y-4\">\n                      {/* Format Selection - Simplified */}\n                      <div className=\"flex flex-wrap gap-2\">\n                        {EXPORT_FORMATS.slice(0, 4).map(format => (\n                          <button\n                            key={format.id}\n                            onClick={() => setSelectedExportFormat(format.id)}\n                            className={`px-4 py-2 rounded-xl text-sm transition-all ${\n                              selectedExportFormat === format.id\n                                ? 'bg-[#4ECDC4] text-[#0a1929]'\n                                : 'bg-[var(--card)] text-[var(--text-secondary)] hover:text-[var(--foreground)] border border-[var(--border-color)]'\n                            }`}\n                          >\n                            {format.name}\n                          </button>\n                        ))}\n                      </div>\n\n                      {/* Prompt Preview */}\n                      <div className=\"card p-6\">\n                        <div className=\"flex items-center justify-between mb-4\">\n                          <div className=\"flex items-center gap-3\">\n                            {selectedTemplate && <span className=\"text-xl\">{selectedTemplate.icon}</span>}\n                            <span className=\"font-medium text-[var(--foreground)]\">\n                              {selectedTemplate?.name || 'Custom Prompt'}\n                            </span>\n                          </div>\n                          <button\n                            onClick={handleCopy}\n                            data-tour=\"run-button\"\n                            className={`flex items-center gap-2 px-5 py-2.5 rounded-xl transition-all font-medium ${\n                              copied\n                                ? 'bg-[#059669] text-white'\n                                : 'bg-[#4ECDC4] text-[#0a1929] hover:bg-[#3dbdb5]'\n                            }`}\n                          >\n                            <Icons.copy className=\"w-4 h-4\" />\n                            {copied ? 'Copied!' : 'Copy Prompt'}\n                          </button>\n                        </div>\n                        <pre className=\"whitespace-pre-wrap text-sm text-[var(--text-secondary)] font-mono max-h-80 overflow-auto bg-[var(--background)] p-4 rounded-lg border border-[var(--border-color)]\">\n                          {formatPromptForExport(selectedExportFormat)}\n                        </pre>\n                      </div>\n\n                      {/* Navigation */}\n                      <div className=\"flex gap-4\">\n                        <button\n                          onClick={() => setCurrentStep('customize')}\n                          className=\"btn-secondary flex-1\"\n                        >\n                          <Icons.arrowLeft className=\"w-4 h-4 inline mr-2\" />\n                          Edit Details\n                        </button>\n                        <button\n                          onClick={() => {\n                            setCurrentStep('template');\n                            setSelectedIndustry(null);\n                            setSelectedTemplate(null);\n                            setPrompt('');\n                            setVariableValues({});\n                          }}\n                          className=\"btn-primary flex-1\"\n                        >\n                          <Icons.plus className=\"w-4 h-4 inline mr-2\" />\n                          Create Another\n                        </button>\n                      </div>\n                    </div>\n\n                    {/* Sidebar - Stats & Tools */}\n                    <div className=\"space-y-4\">\n                      {/* Quick Stats */}\n                      <div className=\"card p-5\">\n                        <h3 className=\"text-sm font-medium text-[var(--text-muted)] mb-4\">Prompt Analysis</h3>\n                        <div className=\"space-y-3\">\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"text-sm text-[var(--text-secondary)]\">Tokens</span>\n                            <span className=\"text-lg font-bold text-[#4ECDC4] tabular-nums\">{analysisResults?.tokens || 0}</span>\n                          </div>\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"text-sm text-[var(--text-secondary)]\">Est. Cost</span>\n                            <span className=\"text-lg font-bold text-[var(--foreground)] tabular-nums\">${analysisResults?.cost.toFixed(4) || '0.0000'}</span>\n                          </div>\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"text-sm text-[var(--text-secondary)]\">Security</span>\n                            <span className={`text-lg font-bold ${analysisResults?.piiCount ? 'text-[#dc2626]' : 'text-[#059669]'}`}>\n                              {analysisResults?.piiCount ? `${analysisResults.piiCount} issues` : '✓ Safe'}\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Quick Actions */}\n                      <div className=\"card p-5\">\n                        <h3 className=\"text-sm font-medium text-[var(--text-muted)] mb-4\">Optimize</h3>\n                        <div className=\"space-y-2\">\n                          <button\n                            onClick={handleOptimize}\n                            className=\"w-full flex items-center gap-3 p-3 rounded-lg bg-[var(--background)] hover:bg-[rgba(78,205,196,0.1)] transition-colors text-left\"\n                          >\n                            <Icons.compress className=\"w-5 h-5 text-[#4ECDC4]\" />\n                            <div>\n                              <div className=\"text-sm font-medium text-[var(--foreground)]\">Compress</div>\n                              <div className=\"text-xs text-[var(--text-muted)]\">Save ~{analysisResults?.compressionSavings || 0}% tokens</div>\n                            </div>\n                          </button>\n                          <button\n                            onClick={handleSecurityScan}\n                            className=\"w-full flex items-center gap-3 p-3 rounded-lg bg-[var(--background)] hover:bg-[rgba(78,205,196,0.1)] transition-colors text-left\"\n                          >\n                            <Icons.shield className=\"w-5 h-5 text-[#dc2626]\" />\n                            <div>\n                              <div className=\"text-sm font-medium text-[var(--foreground)]\">Redact PII</div>\n                              <div className=\"text-xs text-[var(--text-muted)]\">Remove sensitive data</div>\n                            </div>\n                          </button>\n                        </div>\n                      </div>\n\n                      {/* Model Recommendation */}\n                      {selectedTemplate && (\n                        <div className=\"card p-5 bg-[rgba(78,205,196,0.1)] border-[rgba(78,205,196,0.2)]\">\n                          <div className=\"flex items-center gap-2 text-[#4ECDC4] mb-2\">\n                            <Icons.lightbulb className=\"w-4 h-4\" />\n                            <span className=\"text-sm font-medium\">Best Model</span>\n                          </div>\n                          <p className=\"text-xs text-[var(--text-secondary)]\">\n                            {MODEL_RECOMMENDATIONS[selectedTemplate.difficulty].reason}\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Expert Mode */}\n        {mode === 'expert' && (\n          <ExpertMode\n            prompt={prompt}\n            setPrompt={setPrompt}\n            selectedModel={selectedModel}\n            setSelectedModel={setSelectedModel}\n            analysisResults={analysisResults}\n            onCopy={handleCopy}\n            copied={copied}\n            auditMode={auditMode}\n            setAuditMode={setAuditMode}\n            showAgentHelper={showAgentHelper}\n            setShowAgentHelper={setShowAgentHelper}\n          />\n        )}\n      </main>\n\n      {/* History Panel */}\n      {showHistory && (\n        <div className=\"fixed inset-y-0 right-0 w-80 bg-[var(--card)] border-l border-[var(--border-color)] z-50 animate-slide-in\">\n          <div className=\"p-4 border-b border-[var(--border-color)] flex items-center justify-between\">\n            <h3 className=\"font-semibold text-[var(--foreground)]\">Recent Prompts</h3>\n            <button onClick={() => setShowHistory(false)} className=\"p-1 hover:text-[#4ECDC4]\">\n              <Icons.x className=\"w-5 h-5\" />\n            </button>\n          </div>\n          <div className=\"p-4 space-y-3 overflow-auto max-h-[calc(100vh-64px)]\">\n            {history.length === 0 ? (\n              <p className=\"text-[var(--text-muted)] text-sm\">No prompts yet. Create one to get started!</p>\n            ) : (\n              history.map((item, i) => (\n                <button\n                  key={i}\n                  onClick={() => {\n                    setPrompt(item);\n                    setShowHistory(false);\n                    setMode('expert');\n                  }}\n                  className=\"w-full p-3 card text-left hover:border-[#4ECDC4] transition-all\"\n                >\n                  <p className=\"text-sm text-[var(--text-secondary)] line-clamp-3\">{item}</p>\n                </button>\n              ))\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Walkthrough */}\n      <Walkthrough\n        steps={PLAYGROUND_WALKTHROUGH}\n        isOpen={showWalkthrough}\n        onClose={() => setShowWalkthrough(false)}\n        onComplete={() => setShowWalkthrough(false)}\n        storageKey=\"promptforge-playground-tour\"\n      />\n\n      {/* Help Button */}\n      {!showWalkthrough && (\n        <HelpButton onClick={() => setShowWalkthrough(true)} label=\"Help\" />\n      )}\n    </div>\n  );\n}\n\n// Expert Mode Component\nfunction ExpertMode({\n  prompt,\n  setPrompt,\n  selectedModel,\n  setSelectedModel,\n  analysisResults,\n  onCopy,\n  copied,\n  auditMode,\n  setAuditMode,\n  showAgentHelper,\n  setShowAgentHelper,\n}: {\n  prompt: string;\n  setPrompt: (p: string) => void;\n  selectedModel: string;\n  setSelectedModel: (m: string) => void;\n  analysisResults: any;\n  onCopy: () => void;\n  copied: boolean;\n  auditMode: boolean;\n  setAuditMode: (v: boolean) => void;\n  showAgentHelper: boolean;\n  setShowAgentHelper: (v: boolean) => void;\n}) {\n  const [activeFeature, setActiveFeature] = useState<string | null>(null);\n  const [compressionLevel, setCompressionLevel] = useState<'low' | 'medium' | 'high'>('medium');\n  const [outputFormat, setOutputFormat] = useState<'standard' | 'excel' | 'slides' | 'memo'>('standard');\n  const [result, setResult] = useState<React.ReactNode>(null);\n\n  const features = [\n    { id: 'variables', name: 'Variables', icon: 'variable' as const, desc: 'Extract & substitute' },\n    { id: 'compress', name: 'Compress', icon: 'compress' as const, desc: 'Reduce tokens' },\n    { id: 'security', name: 'Security', icon: 'shield' as const, desc: 'PII & injection' },\n    { id: 'cost', name: 'Cost', icon: 'calculator' as const, desc: 'Token pricing' },\n    { id: 'format', name: 'Format', icon: 'spreadsheet' as const, desc: 'Output presets' },\n  ];\n\n  const handleFeatureAction = (featureId: string) => {\n    switch (featureId) {\n      case 'variables': {\n        const vars = extractVariables(prompt);\n        setResult(\n          <div className=\"space-y-3\">\n            <p className=\"text-sm text-[var(--text-secondary)]\">Found {vars.length} variables:</p>\n            {vars.map(v => (\n              <div key={v.name} className=\"flex items-center gap-2 text-sm\">\n                <code className=\"px-2 py-1 bg-[rgba(78,205,196,0.2)] text-[#4ECDC4] rounded\">{`{{${v.name}}}`}</code>\n                {v.defaultValue && <span className=\"text-[var(--text-muted)]\">default: {v.defaultValue}</span>}\n                {v.type && <span className=\"text-[var(--text-muted)]\">type: {v.type}</span>}\n              </div>\n            ))}\n          </div>\n        );\n        break;\n      }\n      case 'compress': {\n        const compressed = compressPrompt(prompt, { aggressiveness: compressionLevel });\n        setPrompt(compressed.compressed);\n        setResult(\n          <div className=\"space-y-3\">\n            <div className=\"grid grid-cols-3 gap-3\">\n              <div className=\"text-center\">\n                <div className=\"text-xl font-bold text-[var(--foreground)] tabular-nums\">{compressed.originalTokens}</div>\n                <div className=\"text-xs text-[var(--text-muted)]\">Original</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-xl font-bold text-[#4ECDC4] tabular-nums\">{compressed.compressedTokens}</div>\n                <div className=\"text-xs text-[var(--text-muted)]\">Compressed</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-xl font-bold text-[#059669] tabular-nums\">{compressed.savings}%</div>\n                <div className=\"text-xs text-[var(--text-muted)]\">Saved</div>\n              </div>\n            </div>\n          </div>\n        );\n        break;\n      }\n      case 'security': {\n        const pii = detectPII(prompt);\n        const { redacted } = redactPII(prompt);\n        const riskLevel = getInjectionRiskLevel(prompt);\n        setPrompt(redacted);\n        setResult(\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center gap-4\">\n              <div>\n                <span className=\"text-sm text-[var(--text-secondary)]\">PII: </span>\n                <span className={`font-bold ${pii.length ? 'text-[#dc2626]' : 'text-[#059669]'}`}>\n                  {pii.length} found\n                </span>\n              </div>\n              <div>\n                <span className=\"text-sm text-[var(--text-secondary)]\">Risk: </span>\n                <span className={`font-bold capitalize ${\n                  riskLevel === 'none' ? 'text-[#059669]' :\n                  riskLevel === 'low' ? 'text-[#4ECDC4]' : 'text-[#dc2626]'\n                }`}>\n                  {riskLevel}\n                </span>\n              </div>\n            </div>\n            <p className=\"text-sm text-[#059669]\">Prompt has been redacted.</p>\n          </div>\n        );\n        break;\n      }\n      case 'cost': {\n        const cost = calculateCost(prompt, 500, selectedModel);\n        setResult(\n          <div className=\"space-y-3\">\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div className=\"text-center\">\n                <div className=\"text-xl font-bold text-[#4ECDC4] tabular-nums\">{cost.inputTokens}</div>\n                <div className=\"text-xs text-[var(--text-muted)]\">Input Tokens</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-xl font-bold text-[var(--foreground)] tabular-nums\">${cost.totalCost.toFixed(4)}</div>\n                <div className=\"text-xs text-[var(--text-muted)]\">Per Request</div>\n              </div>\n            </div>\n          </div>\n        );\n        break;\n      }\n      case 'format': {\n        let formatInstructions = '';\n        switch (outputFormat) {\n          case 'excel':\n            formatInstructions = '\\n\\n=== OUTPUT FORMAT: EXCEL ===\\nPlease format all output as:\\n- Tabular data with clear headers\\n- Currency values: $X,XXX.XX\\n- Percentages: X.X%\\n- Dates: YYYY-MM-DD';\n            break;\n          case 'slides':\n            formatInstructions = '\\n\\n=== OUTPUT FORMAT: SLIDES ===\\nPlease format all output as:\\n- Bullet points (max 5 per section)\\n- Clear section headers\\n- Key metrics highlighted\\n- Executive summary first';\n            break;\n          case 'memo':\n            formatInstructions = '\\n\\n=== OUTPUT FORMAT: MEMO ===\\nPlease structure as:\\n- Executive Summary\\n- Key Findings\\n- Detailed Analysis\\n- Recommendations\\n- Appendix';\n            break;\n        }\n        if (formatInstructions && !prompt.includes('OUTPUT FORMAT')) {\n          setPrompt(prompt + formatInstructions);\n        }\n        setResult(\n          <div className=\"text-sm text-[#059669]\">\n            Output format instructions added to prompt.\n          </div>\n        );\n        break;\n      }\n    }\n  };\n\n  return (\n    <div className=\"grid lg:grid-cols-3 gap-6\">\n      {/* Editor */}\n      <div className=\"lg:col-span-2 space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-xl font-bold text-[var(--foreground)]\">Prompt Editor</h2>\n          <div className=\"flex items-center gap-2\">\n            <select\n              value={selectedModel}\n              onChange={(e) => setSelectedModel(e.target.value)}\n              className=\"bg-[var(--card)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-sm text-[var(--foreground)]\"\n              data-tour=\"model-selector\"\n            >\n              {MODEL_PRICING.map((m) => (\n                <option key={m.id} value={m.id}>{m.name}</option>\n              ))}\n            </select>\n            <button\n              onClick={onCopy}\n              className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${\n                copied ? 'bg-[#059669] text-[var(--foreground)]' : 'bg-[rgba(78,205,196,0.2)] text-[#4ECDC4] hover:bg-[rgba(78,205,196,0.3)]'\n              }`}\n            >\n              <Icons.copy className=\"w-4 h-4\" />\n              {copied ? 'Copied!' : 'Copy'}\n            </button>\n          </div>\n        </div>\n\n        <textarea\n          value={prompt}\n          onChange={(e) => setPrompt(e.target.value)}\n          className=\"input h-96 resize-none font-mono text-sm\"\n          data-tour=\"prompt-editor\"\n          placeholder=\"Enter your financial analysis prompt here...\n\nExpert tips:\n• Use {{variable:default|type}} for typed variables\n• Supported types: text, currency, percentage, number, date, select\n• Add output format instructions for Excel/slides/memo\n• Enable audit mode for compliance tracking\"\n        />\n\n        {/* Quick Stats Bar */}\n        {analysisResults && (\n          <div className=\"flex items-center gap-6 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-[var(--text-muted)]\">Tokens:</span>\n              <span className=\"text-[#4ECDC4] font-medium tabular-nums\">{analysisResults.tokens}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-[var(--text-muted)]\">Cost:</span>\n              <span className=\"text-[var(--foreground)] font-medium tabular-nums\">${analysisResults.cost.toFixed(4)}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-[var(--text-muted)]\">PII:</span>\n              <span className={`font-medium tabular-nums ${analysisResults.piiCount ? 'text-[#dc2626]' : 'text-[#059669]'}`}>\n                {analysisResults.piiCount}\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-[var(--text-muted)]\">Risk:</span>\n              <span className={`font-medium capitalize ${\n                analysisResults.injectionRisk === 'none' ? 'text-[#059669]' :\n                analysisResults.injectionRisk === 'low' ? 'text-[#4ECDC4]' : 'text-[#dc2626]'\n              }`}>\n                {analysisResults.injectionRisk}\n              </span>\n            </div>\n          </div>\n        )}\n\n        {/* Audit Mode Toggle */}\n        <div className=\"card p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Icons.documentChart className=\"w-5 h-5 text-[var(--text-muted)]\" />\n              <div>\n                <div className=\"text-sm font-medium text-[var(--foreground)]\">Audit Mode</div>\n                <div className=\"text-xs text-[var(--text-muted)]\">Log exports for compliance tracking</div>\n              </div>\n            </div>\n            <button\n              onClick={() => setAuditMode(!auditMode)}\n              className={`w-12 h-6 rounded-full transition-colors ${auditMode ? 'bg-[#4ECDC4]' : 'bg-[#334155]'}`}\n            >\n              <div className={`w-5 h-5 rounded-full bg-white shadow transition-transform ${auditMode ? 'translate-x-6' : 'translate-x-0.5'}`} />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Features Panel */}\n      <div className=\"space-y-4\" data-tour=\"variables-panel\">\n        <h2 className=\"text-xl font-bold text-[var(--foreground)]\">Tools</h2>\n\n        <div className=\"space-y-3\">\n          {features.map((f) => {\n            const FeatureIcon = Icons[f.icon as keyof typeof Icons];\n            return (\n              <div key={f.id} className=\"card overflow-hidden\">\n                <button\n                  onClick={() => setActiveFeature(activeFeature === f.id ? null : f.id)}\n                  className=\"w-full p-4 flex items-center justify-between hover:bg-[var(--bg-elevated)] transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-lg bg-[rgba(78,205,196,0.2)] flex items-center justify-center text-[#4ECDC4]\">\n                      {FeatureIcon && <FeatureIcon className=\"w-5 h-5\" />}\n                    </div>\n                    <div className=\"text-left\">\n                      <div className=\"font-medium text-[var(--foreground)]\">{f.name}</div>\n                      <div className=\"text-xs text-[var(--text-muted)]\">{f.desc}</div>\n                    </div>\n                  </div>\n                  <Icons.chevronDown\n                    className={`w-5 h-5 text-[var(--text-muted)] transition-transform ${activeFeature === f.id ? 'rotate-180' : ''}`}\n                  />\n                </button>\n\n                {activeFeature === f.id && (\n                  <div className=\"p-4 border-t border-[var(--border-color)] bg-[var(--background)] animate-fade-in\">\n                    {f.id === 'compress' && (\n                      <div className=\"mb-4\">\n                        <label className=\"text-xs text-[var(--text-muted)] mb-2 block\">Aggressiveness</label>\n                        <div className=\"flex gap-2\">\n                          {(['low', 'medium', 'high'] as const).map((level) => (\n                            <button\n                              key={level}\n                              onClick={() => setCompressionLevel(level)}\n                              className={`flex-1 py-2 rounded-lg text-sm capitalize ${\n                                compressionLevel === level\n                                  ? 'bg-[#4ECDC4] text-[#0a1929]'\n                                  : 'bg-[var(--card)] text-[var(--text-secondary)] border border-[var(--border-color)]'\n                              }`}\n                            >\n                              {level}\n                            </button>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n\n                    {f.id === 'cost' && (\n                      <div className=\"mb-4\">\n                        <label className=\"text-xs text-[var(--text-muted)] mb-2 block\">Model</label>\n                        <select\n                          value={selectedModel}\n                          onChange={(e) => setSelectedModel(e.target.value)}\n                          className=\"w-full bg-[var(--card)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-sm text-[var(--foreground)]\"\n                        >\n                          {MODEL_PRICING.map((m) => (\n                            <option key={m.id} value={m.id}>{m.name} - ${m.inputPricePerMillion}/1M</option>\n                          ))}\n                        </select>\n                      </div>\n                    )}\n\n                    {f.id === 'format' && (\n                      <div className=\"mb-4\">\n                        <label className=\"text-xs text-[var(--text-muted)] mb-2 block\">Output Format</label>\n                        <div className=\"grid grid-cols-2 gap-2\">\n                          {[\n                            { id: 'standard', label: 'Standard' },\n                            { id: 'excel', label: 'Excel Table' },\n                            { id: 'slides', label: 'Slide Bullets' },\n                            { id: 'memo', label: 'Memo Format' },\n                          ].map((fmt) => (\n                            <button\n                              key={fmt.id}\n                              onClick={() => setOutputFormat(fmt.id as any)}\n                              className={`py-2 rounded-lg text-sm ${\n                                outputFormat === fmt.id\n                                  ? 'bg-[#4ECDC4] text-[#0a1929]'\n                                  : 'bg-[var(--card)] text-[var(--text-secondary)] border border-[var(--border-color)]'\n                              }`}\n                            >\n                              {fmt.label}\n                            </button>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n\n                    <button\n                      onClick={() => handleFeatureAction(f.id)}\n                      className=\"btn-primary w-full py-2 text-sm\"\n                      disabled={!prompt}\n                    >\n                      Run {f.name}\n                    </button>\n\n                    {result && activeFeature === f.id && (\n                      <div className=\"mt-4 p-3 bg-[var(--card)] rounded-lg border border-[var(--border-color)]\">\n                        {result}\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Finance Pro Tips */}\n        <div className=\"card p-4 bg-[rgba(78,205,196,0.1)] border-[rgba(78,205,196,0.2)]\">\n          <div className=\"flex items-center gap-2 text-[#4ECDC4] mb-2\">\n            <Icons.lightbulb className=\"w-4 h-4\" />\n            <span className=\"text-sm font-medium\">Finance Pro Tip</span>\n          </div>\n          <p className=\"text-xs text-[var(--text-secondary)]\">\n            Use the Format tool to add Excel-ready or slide-friendly output instructions.\n            Enable Audit Mode for compliance tracking in regulated environments.\n          </p>\n        </div>\n      </div>\n\n      {/* AI Agent Helper */}\n      <AIAgentHelper\n        isOpen={showAgentHelper}\n        onClose={() => setShowAgentHelper(false)}\n        currentPrompt={prompt}\n      />\n    </div>\n  );\n}\n","'use client';\n\nimport { useState, useRef, useEffect, ReactNode } from 'react';\n\ninterface TooltipProps {\n  content: ReactNode;\n  children: ReactNode;\n  position?: 'top' | 'bottom' | 'left' | 'right';\n  delay?: number;\n}\n\nexport function Tooltip({ content, children, position = 'top', delay = 300 }: TooltipProps) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [coords, setCoords] = useState({ x: 0, y: 0 });\n  const triggerRef = useRef<HTMLDivElement>(null);\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const timeoutRef = useRef<NodeJS.Timeout>();\n\n  const showTooltip = () => {\n    timeoutRef.current = setTimeout(() => {\n      setIsVisible(true);\n    }, delay);\n  };\n\n  const hideTooltip = () => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n    setIsVisible(false);\n  };\n\n  useEffect(() => {\n    if (isVisible && triggerRef.current && tooltipRef.current) {\n      const triggerRect = triggerRef.current.getBoundingClientRect();\n      const tooltipRect = tooltipRef.current.getBoundingClientRect();\n\n      let x = 0;\n      let y = 0;\n\n      switch (position) {\n        case 'top':\n          x = triggerRect.left + triggerRect.width / 2 - tooltipRect.width / 2;\n          y = triggerRect.top - tooltipRect.height - 8;\n          break;\n        case 'bottom':\n          x = triggerRect.left + triggerRect.width / 2 - tooltipRect.width / 2;\n          y = triggerRect.bottom + 8;\n          break;\n        case 'left':\n          x = triggerRect.left - tooltipRect.width - 8;\n          y = triggerRect.top + triggerRect.height / 2 - tooltipRect.height / 2;\n          break;\n        case 'right':\n          x = triggerRect.right + 8;\n          y = triggerRect.top + triggerRect.height / 2 - tooltipRect.height / 2;\n          break;\n      }\n\n      // Keep tooltip within viewport\n      x = Math.max(8, Math.min(x, window.innerWidth - tooltipRect.width - 8));\n      y = Math.max(8, Math.min(y, window.innerHeight - tooltipRect.height - 8));\n\n      setCoords({ x, y });\n    }\n  }, [isVisible, position]);\n\n  return (\n    <>\n      <div\n        ref={triggerRef}\n        onMouseEnter={showTooltip}\n        onMouseLeave={hideTooltip}\n        onFocus={showTooltip}\n        onBlur={hideTooltip}\n        className=\"inline-flex\"\n      >\n        {children}\n      </div>\n      {isVisible && (\n        <div\n          ref={tooltipRef}\n          className=\"fixed z-50 px-3 py-2 text-sm bg-gray-800 border border-gray-700 rounded-lg shadow-xl animate-fade-in max-w-xs\"\n          style={{ left: coords.x, top: coords.y }}\n        >\n          {content}\n        </div>\n      )}\n    </>\n  );\n}\n\n// Help icon with tooltip\ninterface HelpTooltipProps {\n  content: ReactNode;\n}\n\nexport function HelpTooltip({ content }: HelpTooltipProps) {\n  return (\n    <Tooltip content={content} position=\"top\">\n      <button className=\"p-1 text-gray-500 hover:text-teal-400 transition-colors rounded-full hover:bg-teal-500/10\">\n        <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z\" />\n        </svg>\n      </button>\n    </Tooltip>\n  );\n}\n","// smart-compression.ts - Intelligent prompt compression to reduce token usage\n// Maintains semantic meaning while reducing costs\n\n// ============================================\n// Types\n// ============================================\n\nexport interface CompressionResult {\n  original: string;\n  compressed: string;\n  originalTokens: number;\n  compressedTokens: number;\n  savings: number; // Percentage\n  changes: CompressionChange[];\n}\n\nexport interface CompressionChange {\n  type: CompressionType;\n  original: string;\n  compressed: string;\n  tokensSaved: number;\n}\n\nexport type CompressionType =\n  | 'remove_redundancy'\n  | 'simplify_phrase'\n  | 'remove_filler'\n  | 'abbreviate'\n  | 'restructure'\n  | 'combine_sentences'\n  | 'remove_examples';\n\nexport interface CompressionOptions {\n  targetReduction?: number; // Target percentage reduction (0-1)\n  preserveExamples?: boolean;\n  preserveFormatting?: boolean;\n  aggressiveness?: 'low' | 'medium' | 'high';\n  customPatterns?: { pattern: RegExp; replacement: string }[];\n}\n\n// ============================================\n// Compression Patterns\n// ============================================\n\ninterface CompressionPattern {\n  type: CompressionType;\n  pattern: RegExp;\n  replacement: string | ((match: string, ...groups: string[]) => string);\n  description: string;\n  aggressiveness: 'low' | 'medium' | 'high';\n}\n\nconst COMPRESSION_PATTERNS: CompressionPattern[] = [\n  // Remove filler words\n  {\n    type: 'remove_filler',\n    pattern: /\\b(basically|essentially|actually|really|very|quite|somewhat|rather)\\b/gi,\n    replacement: '',\n    description: 'Remove filler words',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'remove_filler',\n    pattern: /\\b(in order to)\\b/gi,\n    replacement: 'to',\n    description: 'Simplify \"in order to\"',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'remove_filler',\n    pattern: /\\b(at this point in time)\\b/gi,\n    replacement: 'now',\n    description: 'Simplify \"at this point in time\"',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'remove_filler',\n    pattern: /\\b(due to the fact that)\\b/gi,\n    replacement: 'because',\n    description: 'Simplify \"due to the fact that\"',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'remove_filler',\n    pattern: /\\b(in the event that)\\b/gi,\n    replacement: 'if',\n    description: 'Simplify \"in the event that\"',\n    aggressiveness: 'low',\n  },\n\n  // Simplify phrases\n  {\n    type: 'simplify_phrase',\n    pattern: /\\b(it is important to note that)\\b/gi,\n    replacement: 'Note:',\n    description: 'Simplify importance markers',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'simplify_phrase',\n    pattern: /\\b(please make sure to|please ensure that|make sure to|ensure that)\\b/gi,\n    replacement: '',\n    description: 'Remove unnecessary politeness',\n    aggressiveness: 'medium',\n  },\n  {\n    type: 'simplify_phrase',\n    pattern: /\\b(I would like you to|I want you to)\\b/gi,\n    replacement: '',\n    description: 'Remove request preamble',\n    aggressiveness: 'medium',\n  },\n  {\n    type: 'simplify_phrase',\n    pattern: /\\b(as mentioned (above|earlier|previously|before))\\b/gi,\n    replacement: '',\n    description: 'Remove reference to earlier content',\n    aggressiveness: 'medium',\n  },\n\n  // Remove redundancy\n  {\n    type: 'remove_redundancy',\n    pattern: /\\b(absolutely essential|completely unique|very unique|totally unique)\\b/gi,\n    replacement: (_match: string, ...groups: string[]) => groups[0]?.split(' ').pop() || 'essential',\n    description: 'Remove redundant modifiers',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'remove_redundancy',\n    pattern: /\\b(free gift|advance planning|past history|future plans)\\b/gi,\n    replacement: (_match: string, ...groups: string[]) => groups[0]?.split(' ').pop() || '',\n    description: 'Remove redundant word pairs',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'remove_redundancy',\n    pattern: /(\\.\\s*){2,}/g,\n    replacement: '. ',\n    description: 'Remove multiple periods',\n    aggressiveness: 'low',\n  },\n\n  // Abbreviate common phrases\n  {\n    type: 'abbreviate',\n    pattern: /\\b(for example)\\b/gi,\n    replacement: 'e.g.',\n    description: 'Abbreviate \"for example\"',\n    aggressiveness: 'medium',\n  },\n  {\n    type: 'abbreviate',\n    pattern: /\\b(that is to say)\\b/gi,\n    replacement: 'i.e.',\n    description: 'Abbreviate \"that is to say\"',\n    aggressiveness: 'medium',\n  },\n  {\n    type: 'abbreviate',\n    pattern: /\\b(and so on|et cetera)\\b/gi,\n    replacement: 'etc.',\n    description: 'Abbreviate \"and so on\"',\n    aggressiveness: 'medium',\n  },\n\n  // Restructure verbose constructions\n  {\n    type: 'restructure',\n    pattern: /\\b(the reason (why|that) is (because)?)\\b/gi,\n    replacement: 'because',\n    description: 'Simplify reason constructions',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'restructure',\n    pattern: /\\b(there (is|are) [^.]*? that)\\b/gi,\n    replacement: '',\n    description: 'Remove \"there is/are\" constructions',\n    aggressiveness: 'high',\n  },\n  {\n    type: 'restructure',\n    pattern: /\\b(it is (clear|obvious|evident) that)\\b/gi,\n    replacement: '',\n    description: 'Remove obvious markers',\n    aggressiveness: 'medium',\n  },\n\n  // Remove excessive formatting\n  {\n    type: 'remove_redundancy',\n    pattern: /\\n{3,}/g,\n    replacement: '\\n\\n',\n    description: 'Reduce excessive line breaks',\n    aggressiveness: 'low',\n  },\n  {\n    type: 'remove_redundancy',\n    pattern: /\\s{2,}/g,\n    replacement: ' ',\n    description: 'Reduce excessive spaces',\n    aggressiveness: 'low',\n  },\n];\n\n// ============================================\n// Main Compression Function\n// ============================================\n\n/**\n * Compress a prompt while preserving meaning\n */\nexport function compressPrompt(\n  text: string,\n  options: CompressionOptions = {}\n): CompressionResult {\n  const {\n    targetReduction = 0.3,\n    preserveExamples = true,\n    preserveFormatting = true,\n    aggressiveness = 'medium',\n    customPatterns = [],\n  } = options;\n\n  const originalTokens = estimateTokens(text);\n  const changes: CompressionChange[] = [];\n  let compressed = text;\n\n  // Get applicable patterns based on aggressiveness\n  const aggressivenessLevel = { low: 1, medium: 2, high: 3 };\n  const applicablePatterns = COMPRESSION_PATTERNS.filter(\n    (p) => aggressivenessLevel[p.aggressiveness] <= aggressivenessLevel[aggressiveness]\n  );\n\n  // Apply custom patterns first\n  for (const { pattern, replacement } of customPatterns) {\n    const before = compressed;\n    compressed = compressed.replace(pattern, replacement);\n    if (before !== compressed) {\n      changes.push({\n        type: 'restructure',\n        original: before.match(pattern)?.[0] || '',\n        compressed: replacement,\n        tokensSaved: estimateTokens(before) - estimateTokens(compressed),\n      });\n    }\n  }\n\n  // Apply standard patterns\n  for (const pattern of applicablePatterns) {\n    const before = compressed;\n    compressed = compressed.replace(\n      pattern.pattern,\n      pattern.replacement as string\n    );\n\n    if (before !== compressed) {\n      const match = before.match(pattern.pattern);\n      changes.push({\n        type: pattern.type,\n        original: match?.[0] || '',\n        compressed: typeof pattern.replacement === 'string' ? pattern.replacement : '',\n        tokensSaved: estimateTokens(before) - estimateTokens(compressed),\n      });\n    }\n  }\n\n  // Preserve examples if requested\n  if (!preserveExamples) {\n    const examplePatterns = [\n      /## Examples?\\n[\\s\\S]*?(?=##|$)/gi,\n      /\\bExample:[\\s\\S]*?(?=\\n\\n|$)/gi,\n      /\\bFor instance:[\\s\\S]*?(?=\\n\\n|$)/gi,\n    ];\n\n    for (const pattern of examplePatterns) {\n      const before = compressed;\n      compressed = compressed.replace(pattern, '');\n      if (before !== compressed) {\n        changes.push({\n          type: 'remove_examples',\n          original: before.match(pattern)?.[0] || '',\n          compressed: '',\n          tokensSaved: estimateTokens(before) - estimateTokens(compressed),\n        });\n      }\n    }\n  }\n\n  // Preserve formatting if requested\n  if (!preserveFormatting) {\n    // Remove markdown formatting\n    compressed = compressed\n      .replace(/\\*\\*([^*]+)\\*\\*/g, '$1') // Bold\n      .replace(/__([^_]+)__/g, '$1') // Bold alt\n      .replace(/\\*([^*]+)\\*/g, '$1') // Italic\n      .replace(/_([^_]+)_/g, '$1') // Italic alt\n      .replace(/`([^`]+)`/g, '$1') // Code\n      .replace(/^#+\\s*/gm, ''); // Headers\n  }\n\n  // Clean up\n  compressed = compressed\n    .replace(/\\s+/g, ' ')\n    .replace(/\\n\\s*\\n/g, '\\n\\n')\n    .trim();\n\n  const compressedTokens = estimateTokens(compressed);\n  const savings = ((originalTokens - compressedTokens) / originalTokens) * 100;\n\n  return {\n    original: text,\n    compressed,\n    originalTokens,\n    compressedTokens,\n    savings: Math.round(savings * 10) / 10,\n    changes,\n  };\n}\n\n/**\n * Estimate token count (simplified)\n */\nfunction estimateTokens(text: string): number {\n  return Math.ceil(text.split(/\\s+/).length * 1.3);\n}\n\n// ============================================\n// Semantic-Aware Compression\n// ============================================\n\n/**\n * Compress while preserving semantic structure\n */\nexport function semanticCompress(\n  systemPrompt: string,\n  userPrompt: string,\n  options: CompressionOptions = {}\n): {\n  systemPrompt: CompressionResult;\n  userPrompt: CompressionResult;\n  totalSavings: number;\n} {\n  // Preserve critical parts of system prompt\n  const systemProtectedParts = extractProtectedParts(systemPrompt);\n  let compressibleSystem = systemPrompt;\n\n  for (const part of systemProtectedParts) {\n    compressibleSystem = compressibleSystem.replace(part, `__PROTECTED_${systemProtectedParts.indexOf(part)}__`);\n  }\n\n  const compressedSystem = compressPrompt(compressibleSystem, options);\n\n  // Restore protected parts\n  let finalSystem = compressedSystem.compressed;\n  for (let i = 0; i < systemProtectedParts.length; i++) {\n    finalSystem = finalSystem.replace(`__PROTECTED_${i}__`, systemProtectedParts[i]);\n  }\n\n  compressedSystem.compressed = finalSystem;\n\n  // Compress user prompt\n  const compressedUser = compressPrompt(userPrompt, options);\n\n  const originalTotal = compressedSystem.originalTokens + compressedUser.originalTokens;\n  const compressedTotal = compressedSystem.compressedTokens + compressedUser.compressedTokens;\n  const totalSavings = ((originalTotal - compressedTotal) / originalTotal) * 100;\n\n  return {\n    systemPrompt: compressedSystem,\n    userPrompt: compressedUser,\n    totalSavings: Math.round(totalSavings * 10) / 10,\n  };\n}\n\n/**\n * Extract parts that should not be compressed\n */\nfunction extractProtectedParts(text: string): string[] {\n  const protectedParts: string[] = [];\n\n  // Protect code blocks\n  const codeBlocks = text.match(/```[\\s\\S]*?```/g) || [];\n  protectedParts.push(...codeBlocks);\n\n  // Protect JSON examples\n  const jsonBlocks = text.match(/\\{[\\s\\S]*?\\}/g) || [];\n  protectedParts.push(...jsonBlocks.filter((b) => {\n    try {\n      JSON.parse(b);\n      return true;\n    } catch {\n      return false;\n    }\n  }));\n\n  // Protect variable syntax\n  const variables = text.match(/\\{\\{[^}]+\\}\\}/g) || [];\n  protectedParts.push(...variables);\n\n  // Protect URLs\n  const urls = text.match(/https?:\\/\\/[^\\s]+/g) || [];\n  protectedParts.push(...urls);\n\n  return protectedParts;\n}\n\n// ============================================\n// Compression Suggestions\n// ============================================\n\nexport interface CompressionSuggestion {\n  type: CompressionType;\n  original: string;\n  suggested: string;\n  potentialSavings: number;\n  explanation: string;\n  apply: () => string;\n}\n\n/**\n * Get compression suggestions without applying them\n */\nexport function getCompressionSuggestions(text: string): CompressionSuggestion[] {\n  const suggestions: CompressionSuggestion[] = [];\n\n  for (const pattern of COMPRESSION_PATTERNS) {\n    const matches = text.matchAll(new RegExp(pattern.pattern.source, 'gi'));\n\n    for (const match of matches) {\n      const original = match[0];\n      const suggested = typeof pattern.replacement === 'function'\n        ? pattern.replacement(original, ...match.slice(1))\n        : original.replace(pattern.pattern, pattern.replacement);\n\n      if (original !== suggested) {\n        suggestions.push({\n          type: pattern.type,\n          original,\n          suggested,\n          potentialSavings: estimateTokens(original) - estimateTokens(suggested),\n          explanation: pattern.description,\n          apply: () => text.replace(original, suggested),\n        });\n      }\n    }\n  }\n\n  // Sort by potential savings\n  suggestions.sort((a, b) => b.potentialSavings - a.potentialSavings);\n\n  return suggestions;\n}\n\n// ============================================\n// Batch Compression\n// ============================================\n\nexport interface BatchCompressionResult {\n  results: CompressionResult[];\n  totalOriginalTokens: number;\n  totalCompressedTokens: number;\n  overallSavings: number;\n  avgSavingsPerPrompt: number;\n}\n\n/**\n * Compress multiple prompts\n */\nexport function batchCompress(\n  prompts: string[],\n  options: CompressionOptions = {}\n): BatchCompressionResult {\n  const results = prompts.map((p) => compressPrompt(p, options));\n\n  const totalOriginalTokens = results.reduce((sum, r) => sum + r.originalTokens, 0);\n  const totalCompressedTokens = results.reduce((sum, r) => sum + r.compressedTokens, 0);\n  const overallSavings = ((totalOriginalTokens - totalCompressedTokens) / totalOriginalTokens) * 100;\n\n  return {\n    results,\n    totalOriginalTokens,\n    totalCompressedTokens,\n    overallSavings: Math.round(overallSavings * 10) / 10,\n    avgSavingsPerPrompt: Math.round((results.reduce((sum, r) => sum + r.savings, 0) / results.length) * 10) / 10,\n  };\n}\n\n// ============================================\n// Cost Savings Calculator\n// ============================================\n\nexport interface CostSavingsEstimate {\n  originalCost: number;\n  compressedCost: number;\n  savingsPerExecution: number;\n  monthlySavings: number;\n  yearlySavings: number;\n}\n\n/**\n * Estimate cost savings from compression\n */\nexport function estimateCostSavings(\n  compressionResult: CompressionResult,\n  modelPricePerMillionTokens: number,\n  monthlyExecutions: number\n): CostSavingsEstimate {\n  const originalCost = (compressionResult.originalTokens * modelPricePerMillionTokens) / 1_000_000;\n  const compressedCost = (compressionResult.compressedTokens * modelPricePerMillionTokens) / 1_000_000;\n  const savingsPerExecution = originalCost - compressedCost;\n\n  return {\n    originalCost,\n    compressedCost,\n    savingsPerExecution,\n    monthlySavings: savingsPerExecution * monthlyExecutions,\n    yearlySavings: savingsPerExecution * monthlyExecutions * 12,\n  };\n}\n\n// ============================================\n// Compression Quality Check\n// ============================================\n\n/**\n * Check if compression preserves key information\n */\nexport function validateCompression(\n  original: string,\n  compressed: string\n): { valid: boolean; warnings: string[] } {\n  const warnings: string[] = [];\n\n  // Check if variables are preserved\n  const originalVars = original.match(/\\{\\{[^}]+\\}\\}/g) || [];\n  const compressedVars = compressed.match(/\\{\\{[^}]+\\}\\}/g) || [];\n\n  if (originalVars.length !== compressedVars.length) {\n    warnings.push('Some variables may have been removed');\n  }\n\n  // Check if URLs are preserved\n  const originalUrls = original.match(/https?:\\/\\/[^\\s]+/g) || [];\n  const compressedUrls = compressed.match(/https?:\\/\\/[^\\s]+/g) || [];\n\n  if (originalUrls.length !== compressedUrls.length) {\n    warnings.push('Some URLs may have been removed');\n  }\n\n  // Check for excessive compression\n  const compressionRatio = compressed.length / original.length;\n  if (compressionRatio < 0.3) {\n    warnings.push('Compression may be too aggressive - verify meaning is preserved');\n  }\n\n  return {\n    valid: warnings.length === 0,\n    warnings,\n  };\n}\n","// security.ts - PII detection, prompt injection protection, and audit logging\n\n// ============================================\n// PII Detection\n// ============================================\n\nexport interface PIIMatch {\n  type: PIIType;\n  value: string;\n  redactedValue: string;\n  startIndex: number;\n  endIndex: number;\n  confidence: 'high' | 'medium' | 'low';\n}\n\nexport type PIIType =\n  | 'email'\n  | 'phone'\n  | 'ssn'\n  | 'credit_card'\n  | 'ip_address'\n  | 'date_of_birth'\n  | 'address'\n  | 'name'\n  | 'passport'\n  | 'driver_license'\n  | 'bank_account'\n  | 'api_key'\n  | 'password';\n\nexport interface PIIPattern {\n  type: PIIType;\n  pattern: RegExp;\n  confidence: PIIMatch['confidence'];\n  description: string;\n}\n\nconst PII_PATTERNS: PIIPattern[] = [\n  // Email\n  {\n    type: 'email',\n    pattern: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}/g,\n    confidence: 'high',\n    description: 'Email address',\n  },\n  // Phone numbers (various formats)\n  {\n    type: 'phone',\n    pattern: /(?:\\+?1[-.\\s]?)?\\(?[0-9]{3}\\)?[-.\\s]?[0-9]{3}[-.\\s]?[0-9]{4}/g,\n    confidence: 'high',\n    description: 'Phone number',\n  },\n  // SSN\n  {\n    type: 'ssn',\n    pattern: /\\b\\d{3}[-\\s]?\\d{2}[-\\s]?\\d{4}\\b/g,\n    confidence: 'high',\n    description: 'Social Security Number',\n  },\n  // Credit card numbers\n  {\n    type: 'credit_card',\n    pattern: /\\b(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12}|3(?:0[0-5]|[68][0-9])[0-9]{11})\\b/g,\n    confidence: 'high',\n    description: 'Credit card number',\n  },\n  // IP addresses\n  {\n    type: 'ip_address',\n    pattern: /\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b/g,\n    confidence: 'high',\n    description: 'IP address',\n  },\n  // Date of birth patterns\n  {\n    type: 'date_of_birth',\n    pattern: /\\b(?:DOB|Date of Birth|Born|Birthday)[:\\s]*(\\d{1,2}[\\/\\-]\\d{1,2}[\\/\\-]\\d{2,4})\\b/gi,\n    confidence: 'medium',\n    description: 'Date of birth',\n  },\n  // API keys (common patterns)\n  {\n    type: 'api_key',\n    pattern: /\\b(?:sk-[a-zA-Z0-9]{20,}|api[_-]?key[:\\s=]+['\"]?[a-zA-Z0-9_-]{20,}['\"]?)\\b/gi,\n    confidence: 'high',\n    description: 'API key',\n  },\n  // AWS access keys\n  {\n    type: 'api_key',\n    pattern: /\\bAKIA[0-9A-Z]{16}\\b/g,\n    confidence: 'high',\n    description: 'AWS Access Key',\n  },\n  // Passwords in common formats\n  {\n    type: 'password',\n    pattern: /(?:password|passwd|pwd)[:\\s=]+['\"]?[^\\s'\"]{8,}['\"]?/gi,\n    confidence: 'medium',\n    description: 'Password',\n  },\n  // Bank account numbers (basic)\n  {\n    type: 'bank_account',\n    pattern: /\\b(?:account|acct)[:\\s#]*\\d{8,17}\\b/gi,\n    confidence: 'medium',\n    description: 'Bank account number',\n  },\n  // Passport numbers\n  {\n    type: 'passport',\n    pattern: /\\b(?:passport)[:\\s#]*[A-Z0-9]{6,9}\\b/gi,\n    confidence: 'medium',\n    description: 'Passport number',\n  },\n];\n\n/**\n * Detect PII in text\n */\nexport function detectPII(text: string): PIIMatch[] {\n  const matches: PIIMatch[] = [];\n\n  for (const pattern of PII_PATTERNS) {\n    let match;\n    const regex = new RegExp(pattern.pattern.source, pattern.pattern.flags);\n\n    while ((match = regex.exec(text)) !== null) {\n      const value = match[0];\n      matches.push({\n        type: pattern.type,\n        value,\n        redactedValue: redactValue(value, pattern.type),\n        startIndex: match.index,\n        endIndex: match.index + value.length,\n        confidence: pattern.confidence,\n      });\n    }\n  }\n\n  // Sort by position\n  matches.sort((a, b) => a.startIndex - b.startIndex);\n\n  // Remove overlapping matches (keep higher confidence)\n  const filtered: PIIMatch[] = [];\n  for (const match of matches) {\n    const overlapping = filtered.find(\n      (m) => match.startIndex < m.endIndex && match.endIndex > m.startIndex\n    );\n    if (!overlapping) {\n      filtered.push(match);\n    } else if (\n      match.confidence === 'high' &&\n      overlapping.confidence !== 'high'\n    ) {\n      const idx = filtered.indexOf(overlapping);\n      filtered[idx] = match;\n    }\n  }\n\n  return filtered;\n}\n\n/**\n * Redact a value based on type\n */\nfunction redactValue(value: string, type: PIIType): string {\n  switch (type) {\n    case 'email':\n      const [user, domain] = value.split('@');\n      return `${user[0]}***@${domain}`;\n    case 'phone':\n      return value.replace(/\\d(?=\\d{4})/g, '*');\n    case 'ssn':\n      return '***-**-' + value.slice(-4);\n    case 'credit_card':\n      return '**** **** **** ' + value.slice(-4);\n    case 'api_key':\n      return value.slice(0, 4) + '****' + value.slice(-4);\n    default:\n      if (value.length <= 4) return '****';\n      return value.slice(0, 2) + '*'.repeat(value.length - 4) + value.slice(-2);\n  }\n}\n\n/**\n * Redact all PII in text\n */\nexport function redactPII(text: string): { redacted: string; matches: PIIMatch[] } {\n  const matches = detectPII(text);\n  let redacted = text;\n\n  // Replace from end to preserve indices\n  for (let i = matches.length - 1; i >= 0; i--) {\n    const match = matches[i];\n    redacted =\n      redacted.slice(0, match.startIndex) +\n      match.redactedValue +\n      redacted.slice(match.endIndex);\n  }\n\n  return { redacted, matches };\n}\n\n/**\n * Check if text contains high-risk PII\n */\nexport function hasHighRiskPII(text: string): boolean {\n  const highRiskTypes: PIIType[] = ['ssn', 'credit_card', 'api_key', 'password', 'bank_account'];\n  const matches = detectPII(text);\n  return matches.some((m) => highRiskTypes.includes(m.type) && m.confidence === 'high');\n}\n\n// ============================================\n// Prompt Injection Detection\n// ============================================\n\nexport interface InjectionRisk {\n  type: InjectionType;\n  severity: 'high' | 'medium' | 'low';\n  pattern: string;\n  description: string;\n  position: { start: number; end: number };\n}\n\nexport type InjectionType =\n  | 'instruction_override'\n  | 'role_hijack'\n  | 'delimiter_attack'\n  | 'encoding_attack'\n  | 'recursive_injection'\n  | 'context_manipulation';\n\ninterface InjectionPattern {\n  type: InjectionType;\n  patterns: RegExp[];\n  severity: InjectionRisk['severity'];\n  description: string;\n}\n\nconst INJECTION_PATTERNS: InjectionPattern[] = [\n  {\n    type: 'instruction_override',\n    patterns: [\n      /ignore\\s+(all\\s+)?(previous|above|prior)\\s+(instructions?|text|context)/gi,\n      /disregard\\s+(all\\s+)?(previous|above|prior)/gi,\n      /forget\\s+(everything|all|what)/gi,\n      /new\\s+instructions?:/gi,\n      /override\\s+(system|instructions?)/gi,\n    ],\n    severity: 'high',\n    description: 'Attempts to override previous instructions',\n  },\n  {\n    type: 'role_hijack',\n    patterns: [\n      /you\\s+are\\s+(now|actually|really)/gi,\n      /pretend\\s+(to\\s+be|you('re)?)/gi,\n      /act\\s+as\\s+(if|though)/gi,\n      /roleplay\\s+as/gi,\n      /assume\\s+the\\s+(role|identity)/gi,\n    ],\n    severity: 'high',\n    description: 'Attempts to change the AI role or persona',\n  },\n  {\n    type: 'delimiter_attack',\n    patterns: [\n      /```\\s*(system|admin|developer)/gi,\n      /\\[SYSTEM\\]/gi,\n      /<\\/?system>/gi,\n      /###\\s*(SYSTEM|ADMIN)/gi,\n      /---\\s*END\\s*(PROMPT|SYSTEM)/gi,\n    ],\n    severity: 'medium',\n    description: 'Uses delimiters to inject system-level content',\n  },\n  {\n    type: 'encoding_attack',\n    patterns: [\n      /base64[:\\s]/gi,\n      /\\\\x[0-9a-f]{2}/gi,\n      /\\\\u[0-9a-f]{4}/gi,\n      /&#x?[0-9a-f]+;/gi,\n    ],\n    severity: 'medium',\n    description: 'Uses encoding to hide malicious content',\n  },\n  {\n    type: 'recursive_injection',\n    patterns: [\n      /repeat\\s+(this|the\\s+following)\\s+(forever|indefinitely)/gi,\n      /infinite\\s+loop/gi,\n      /call\\s+yourself/gi,\n    ],\n    severity: 'low',\n    description: 'Attempts to create recursive behavior',\n  },\n  {\n    type: 'context_manipulation',\n    patterns: [\n      /the\\s+user\\s+(actually\\s+)?wants/gi,\n      /what\\s+they\\s+really\\s+mean/gi,\n      /the\\s+real\\s+question/gi,\n      /between\\s+the\\s+lines/gi,\n    ],\n    severity: 'low',\n    description: 'Attempts to manipulate context interpretation',\n  },\n];\n\n/**\n * Detect potential prompt injection attempts\n */\nexport function detectInjection(text: string): InjectionRisk[] {\n  const risks: InjectionRisk[] = [];\n\n  for (const pattern of INJECTION_PATTERNS) {\n    for (const regex of pattern.patterns) {\n      let match;\n      const r = new RegExp(regex.source, regex.flags);\n\n      while ((match = r.exec(text)) !== null) {\n        risks.push({\n          type: pattern.type,\n          severity: pattern.severity,\n          pattern: match[0],\n          description: pattern.description,\n          position: {\n            start: match.index,\n            end: match.index + match[0].length,\n          },\n        });\n      }\n    }\n  }\n\n  // Sort by severity\n  const severityOrder = { high: 0, medium: 1, low: 2 };\n  risks.sort((a, b) => severityOrder[a.severity] - severityOrder[b.severity]);\n\n  return risks;\n}\n\n/**\n * Get overall injection risk level\n */\nexport function getInjectionRiskLevel(\n  text: string\n): 'none' | 'low' | 'medium' | 'high' {\n  const risks = detectInjection(text);\n\n  if (risks.length === 0) return 'none';\n  if (risks.some((r) => r.severity === 'high')) return 'high';\n  if (risks.some((r) => r.severity === 'medium')) return 'medium';\n  return 'low';\n}\n\n/**\n * Sanitize input to reduce injection risk\n */\nexport function sanitizeInput(text: string): string {\n  let sanitized = text;\n\n  // Remove common delimiter attacks\n  sanitized = sanitized.replace(/```\\s*(system|admin)/gi, '```');\n  sanitized = sanitized.replace(/\\[SYSTEM\\]/gi, '[USER]');\n  sanitized = sanitized.replace(/<\\/?system>/gi, '');\n\n  // Escape potential code injection\n  sanitized = sanitized.replace(/\\\\/g, '\\\\\\\\');\n\n  return sanitized;\n}\n\n// ============================================\n// Audit Logging\n// ============================================\n\nexport interface AuditLogEntry {\n  id: string;\n  timestamp: string;\n  userId: string;\n  workspaceId: string;\n  action: AuditAction;\n  resourceType: ResourceType;\n  resourceId: string;\n  resourceName?: string;\n  details: Record<string, unknown>;\n  ipAddress?: string;\n  userAgent?: string;\n  success: boolean;\n  errorMessage?: string;\n}\n\nexport type AuditAction =\n  | 'create'\n  | 'read'\n  | 'update'\n  | 'delete'\n  | 'execute'\n  | 'export'\n  | 'import'\n  | 'share'\n  | 'fork'\n  | 'login'\n  | 'logout'\n  | 'api_key_create'\n  | 'api_key_revoke'\n  | 'settings_change';\n\nexport type ResourceType =\n  | 'prompt'\n  | 'template'\n  | 'experiment'\n  | 'workspace'\n  | 'user'\n  | 'api_key'\n  | 'execution';\n\n/**\n * Create an audit log entry\n */\nexport function createAuditLog(\n  params: Omit<AuditLogEntry, 'id' | 'timestamp'>\n): AuditLogEntry {\n  return {\n    id: `audit_${Date.now()}_${Math.random().toString(36).slice(2)}`,\n    timestamp: new Date().toISOString(),\n    ...params,\n  };\n}\n\n/**\n * Format audit log for display\n */\nexport function formatAuditLog(entry: AuditLogEntry): string {\n  const actionVerbs: Record<AuditAction, string> = {\n    create: 'created',\n    read: 'viewed',\n    update: 'updated',\n    delete: 'deleted',\n    execute: 'executed',\n    export: 'exported',\n    import: 'imported',\n    share: 'shared',\n    fork: 'forked',\n    login: 'logged in',\n    logout: 'logged out',\n    api_key_create: 'created API key',\n    api_key_revoke: 'revoked API key',\n    settings_change: 'changed settings',\n  };\n\n  const verb = actionVerbs[entry.action] || entry.action;\n  const resource = entry.resourceName || entry.resourceId;\n\n  return `${verb} ${entry.resourceType} \"${resource}\"`;\n}\n\n// ============================================\n// Compliance Helpers\n// ============================================\n\nexport interface ComplianceConfig {\n  piiDetection: boolean;\n  piiAutoRedact: boolean;\n  injectionDetection: boolean;\n  auditLogging: boolean;\n  dataRetentionDays: number;\n  allowedRegions: string[];\n}\n\nexport const COMPLIANCE_PRESETS: Record<string, ComplianceConfig> = {\n  standard: {\n    piiDetection: true,\n    piiAutoRedact: false,\n    injectionDetection: true,\n    auditLogging: true,\n    dataRetentionDays: 90,\n    allowedRegions: ['us', 'eu'],\n  },\n  hipaa: {\n    piiDetection: true,\n    piiAutoRedact: true,\n    injectionDetection: true,\n    auditLogging: true,\n    dataRetentionDays: 2555, // 7 years\n    allowedRegions: ['us'],\n  },\n  gdpr: {\n    piiDetection: true,\n    piiAutoRedact: true,\n    injectionDetection: true,\n    auditLogging: true,\n    dataRetentionDays: 30, // Minimal retention\n    allowedRegions: ['eu'],\n  },\n  soc2: {\n    piiDetection: true,\n    piiAutoRedact: false,\n    injectionDetection: true,\n    auditLogging: true,\n    dataRetentionDays: 365,\n    allowedRegions: ['us', 'eu', 'apac'],\n  },\n};\n\n/**\n * Check if content complies with configuration\n */\nexport function checkCompliance(\n  text: string,\n  config: ComplianceConfig\n): {\n  compliant: boolean;\n  issues: string[];\n  warnings: string[];\n} {\n  const issues: string[] = [];\n  const warnings: string[] = [];\n\n  // PII checks\n  if (config.piiDetection) {\n    const piiMatches = detectPII(text);\n    if (piiMatches.length > 0) {\n      if (config.piiAutoRedact) {\n        warnings.push(`Found ${piiMatches.length} PII item(s) - will be auto-redacted`);\n      } else {\n        issues.push(`Contains ${piiMatches.length} PII item(s): ${piiMatches.map(m => m.type).join(', ')}`);\n      }\n    }\n  }\n\n  // Injection checks\n  if (config.injectionDetection) {\n    const injectionRisks = detectInjection(text);\n    const highRisks = injectionRisks.filter(r => r.severity === 'high');\n    if (highRisks.length > 0) {\n      issues.push(`High-risk injection patterns detected: ${highRisks.map(r => r.type).join(', ')}`);\n    }\n  }\n\n  return {\n    compliant: issues.length === 0,\n    issues,\n    warnings,\n  };\n}\n","// variable-system.ts - Template variable detection and management\n// Supports {{variable}}, {{variable:default}}, and {{variable|type}}\n\nexport interface TemplateVariable {\n  name: string;\n  defaultValue?: string;\n  type?: 'string' | 'number' | 'boolean' | 'array' | 'json';\n  description?: string;\n  required: boolean;\n  position: { start: number; end: number };\n}\n\nexport interface VariableValues {\n  [key: string]: string | number | boolean | unknown[];\n}\n\n// ============================================\n// Variable Detection\n// ============================================\n\nconst VARIABLE_REGEX = /\\{\\{([^}]+)\\}\\}/g;\nconst VARIABLE_PARTS_REGEX = /^([a-zA-Z_][a-zA-Z0-9_]*)(?::([^|]*))?(?:\\|(\\w+))?$/;\n\n/**\n * Extract all variables from a template string\n */\nexport function extractVariables(template: string): TemplateVariable[] {\n  const variables: TemplateVariable[] = [];\n  const seen = new Set<string>();\n  let match;\n\n  while ((match = VARIABLE_REGEX.exec(template)) !== null) {\n    const fullMatch = match[0];\n    const inner = match[1].trim();\n    const partsMatch = inner.match(VARIABLE_PARTS_REGEX);\n\n    if (partsMatch) {\n      const name = partsMatch[1];\n      const defaultValue = partsMatch[2];\n      const type = partsMatch[3] as TemplateVariable['type'];\n\n      if (!seen.has(name)) {\n        seen.add(name);\n        variables.push({\n          name,\n          defaultValue,\n          type: type || 'string',\n          required: defaultValue === undefined,\n          position: {\n            start: match.index,\n            end: match.index + fullMatch.length,\n          },\n        });\n      }\n    }\n  }\n\n  return variables;\n}\n\n/**\n * Check if a string contains template variables\n */\nexport function hasVariables(template: string): boolean {\n  return VARIABLE_REGEX.test(template);\n}\n\n/**\n * Count variables in a template\n */\nexport function countVariables(template: string): number {\n  const matches = template.match(VARIABLE_REGEX);\n  return matches ? new Set(matches.map(m => m.slice(2, -2).split(':')[0].split('|')[0].trim())).size : 0;\n}\n\n// ============================================\n// Variable Substitution\n// ============================================\n\n/**\n * Replace variables in template with provided values\n */\nexport function substituteVariables(\n  template: string,\n  values: VariableValues,\n  options: {\n    strict?: boolean; // Throw on missing required variables\n    preserveUnknown?: boolean; // Keep {{var}} if not in values\n  } = {}\n): string {\n  const { strict = false, preserveUnknown = false } = options;\n  const variables = extractVariables(template);\n  const missingRequired: string[] = [];\n\n  let result = template;\n\n  // Sort by position descending to avoid offset issues\n  const sortedVars = [...variables].sort((a, b) => b.position.start - a.position.start);\n\n  for (const variable of sortedVars) {\n    const { name, defaultValue, type, required } = variable;\n    let value = values[name];\n\n    // Use default if no value provided\n    if (value === undefined) {\n      if (defaultValue !== undefined) {\n        value = defaultValue;\n      } else if (required) {\n        missingRequired.push(name);\n        if (!preserveUnknown) continue;\n      } else if (preserveUnknown) {\n        continue;\n      }\n    }\n\n    // Type coercion\n    const stringValue = coerceToString(value, type);\n\n    // Replace all occurrences of this variable\n    const pattern = new RegExp(`\\\\{\\\\{${name}(?::[^|]*)?(?:\\\\|\\\\w+)?\\\\}\\\\}`, 'g');\n    result = result.replace(pattern, stringValue);\n  }\n\n  if (strict && missingRequired.length > 0) {\n    throw new Error(`Missing required variables: ${missingRequired.join(', ')}`);\n  }\n\n  return result;\n}\n\n/**\n * Coerce value to string based on type hint\n */\nfunction coerceToString(value: unknown, type?: string): string {\n  if (value === undefined || value === null) return '';\n\n  switch (type) {\n    case 'json':\n      return typeof value === 'string' ? value : JSON.stringify(value, null, 2);\n    case 'array':\n      return Array.isArray(value) ? value.join(', ') : String(value);\n    case 'number':\n      return String(Number(value));\n    case 'boolean':\n      return value ? 'true' : 'false';\n    default:\n      return String(value);\n  }\n}\n\n// ============================================\n// Batch Processing\n// ============================================\n\nexport interface BatchInput {\n  id: string;\n  values: VariableValues;\n}\n\nexport interface BatchResult {\n  id: string;\n  input: VariableValues;\n  renderedPrompt: string;\n  success: boolean;\n  error?: string;\n}\n\n/**\n * Process template with multiple input sets\n */\nexport function batchSubstitute(\n  template: string,\n  inputs: BatchInput[]\n): BatchResult[] {\n  return inputs.map((input) => {\n    try {\n      const renderedPrompt = substituteVariables(template, input.values, { strict: true });\n      return {\n        id: input.id,\n        input: input.values,\n        renderedPrompt,\n        success: true,\n      };\n    } catch (error) {\n      return {\n        id: input.id,\n        input: input.values,\n        renderedPrompt: '',\n        success: false,\n        error: (error as Error).message,\n      };\n    }\n  });\n}\n\n/**\n * Parse CSV data into batch inputs\n */\nexport function parseCsvToBatchInputs(\n  csvContent: string,\n  delimiter: string = ','\n): BatchInput[] {\n  const lines = csvContent.trim().split('\\n');\n  if (lines.length < 2) return [];\n\n  const headers = lines[0].split(delimiter).map((h) => h.trim());\n  const inputs: BatchInput[] = [];\n\n  for (let i = 1; i < lines.length; i++) {\n    const values = lines[i].split(delimiter);\n    const input: VariableValues = {};\n\n    headers.forEach((header, index) => {\n      input[header] = values[index]?.trim() || '';\n    });\n\n    inputs.push({\n      id: `row-${i}`,\n      values: input,\n    });\n  }\n\n  return inputs;\n}\n\n// ============================================\n// Variable Form Generation\n// ============================================\n\nexport interface VariableFormField {\n  name: string;\n  label: string;\n  type: 'text' | 'number' | 'checkbox' | 'textarea' | 'select';\n  placeholder?: string;\n  defaultValue?: string;\n  required: boolean;\n  options?: string[]; // For select type\n}\n\n/**\n * Generate form fields from extracted variables\n */\nexport function generateFormFields(variables: TemplateVariable[]): VariableFormField[] {\n  return variables.map((v) => {\n    const label = v.name\n      .replace(/_/g, ' ')\n      .replace(/([A-Z])/g, ' $1')\n      .trim()\n      .split(' ')\n      .map((w) => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())\n      .join(' ');\n\n    let fieldType: VariableFormField['type'] = 'text';\n    if (v.type === 'number') fieldType = 'number';\n    if (v.type === 'boolean') fieldType = 'checkbox';\n    if (v.type === 'json' || v.type === 'array') fieldType = 'textarea';\n\n    return {\n      name: v.name,\n      label,\n      type: fieldType,\n      placeholder: v.description || `Enter ${label.toLowerCase()}`,\n      defaultValue: v.defaultValue,\n      required: v.required,\n    };\n  });\n}\n\n// ============================================\n// Template Validation\n// ============================================\n\nexport interface ValidationResult {\n  valid: boolean;\n  errors: string[];\n  warnings: string[];\n}\n\n/**\n * Validate template syntax\n */\nexport function validateTemplate(template: string): ValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Check for unbalanced braces\n  const openCount = (template.match(/\\{\\{/g) || []).length;\n  const closeCount = (template.match(/\\}\\}/g) || []).length;\n\n  if (openCount !== closeCount) {\n    errors.push(`Unbalanced braces: ${openCount} opening, ${closeCount} closing`);\n  }\n\n  // Check for invalid variable names\n  const variables = extractVariables(template);\n  for (const v of variables) {\n    if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(v.name)) {\n      errors.push(`Invalid variable name: \"${v.name}\"`);\n    }\n    if (v.type && !['string', 'number', 'boolean', 'array', 'json'].includes(v.type)) {\n      errors.push(`Invalid type \"${v.type}\" for variable \"${v.name}\"`);\n    }\n  }\n\n  // Check for duplicate variables with different defaults\n  const varDefaults = new Map<string, string>();\n  for (const v of variables) {\n    if (varDefaults.has(v.name) && varDefaults.get(v.name) !== v.defaultValue) {\n      warnings.push(`Variable \"${v.name}\" has inconsistent default values`);\n    }\n    varDefaults.set(v.name, v.defaultValue || '');\n  }\n\n  // Check for empty variable names\n  if (template.includes('{{}}')) {\n    errors.push('Empty variable name found: {{}}');\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors,\n    warnings,\n  };\n}\n\n// ============================================\n// Export Functions\n// ============================================\n\nexport function exportToPython(template: string, variables: TemplateVariable[]): string {\n  const varList = variables.map((v) => v.name).join(', ');\n  const escaped = template.replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n');\n\n  return `# Generated by PromptForge\nfrom string import Template\nimport re\n\ndef render_prompt(${varList}):\n    template = \"${escaped}\"\n\n    # Replace variables\n    ${variables.map((v) => `template = template.replace(\"{{${v.name}}}\", str(${v.name}))`).join('\\n    ')}\n\n    return template\n\n# Example usage:\n# result = render_prompt(${variables.map((v) => `${v.name}=\"${v.defaultValue || 'value'}\"`).join(', ')})\n`;\n}\n\nexport function exportToJavaScript(template: string, variables: TemplateVariable[]): string {\n  const varList = variables.map((v) => v.name).join(', ');\n  const escaped = template.replace(/`/g, '\\\\`').replace(/\\$/g, '\\\\$');\n\n  return `// Generated by PromptForge\n\nfunction renderPrompt({ ${varList} }) {\n  let template = \\`${escaped}\\`;\n\n  ${variables.map((v) => `template = template.replace(/\\\\{\\\\{${v.name}(?::[^|]*)?(?:\\\\|\\\\w+)?\\\\}\\\\}/g, String(${v.name}));`).join('\\n  ')}\n\n  return template;\n}\n\n// Example usage:\n// const result = renderPrompt({ ${variables.map((v) => `${v.name}: \"${v.defaultValue || 'value'}\"`).join(', ')} });\n\nexport { renderPrompt };\n`;\n}\n\nexport function exportToTypeScript(template: string, variables: TemplateVariable[]): string {\n  const interfaceFields = variables\n    .map((v) => {\n      const tsType = v.type === 'number' ? 'number' : v.type === 'boolean' ? 'boolean' : 'string';\n      return `  ${v.name}${v.required ? '' : '?'}: ${tsType};`;\n    })\n    .join('\\n');\n\n  const escaped = template.replace(/`/g, '\\\\`').replace(/\\$/g, '\\\\$');\n\n  return `// Generated by PromptForge\n\ninterface PromptVariables {\n${interfaceFields}\n}\n\nfunction renderPrompt(variables: PromptVariables): string {\n  let template = \\`${escaped}\\`;\n\n  ${variables.map((v) => `template = template.replace(/\\\\{\\\\{${v.name}(?::[^|]*)?(?:\\\\|\\\\w+)?\\\\}\\\\}/g, String(variables.${v.name}${v.required ? '' : ` ?? \"${v.defaultValue || ''}\"`}));`).join('\\n  ')}\n\n  return template;\n}\n\nexport { renderPrompt, type PromptVariables };\n`;\n}\n","// cost-calculator.ts - Token estimation and cost calculation\n// Real-time cost preview and optimization suggestions\n\nimport type { AIModel } from '@/types/prompt.types';\n\n// ============================================\n// Model Pricing (per million tokens)\n// ============================================\n\nexport interface ModelPricing {\n  id: string;\n  name: string;\n  provider: string;\n  inputPricePerMillion: number;\n  outputPricePerMillion: number;\n  contextWindow: number;\n  maxOutput: number;\n}\n\nexport const MODEL_PRICING: ModelPricing[] = [\n  // Anthropic\n  {\n    id: 'claude-opus-4-5-20250514',\n    name: 'Claude Opus 4.5',\n    provider: 'anthropic',\n    inputPricePerMillion: 15,\n    outputPricePerMillion: 75,\n    contextWindow: 200000,\n    maxOutput: 32000,\n  },\n  {\n    id: 'claude-sonnet-4-20250514',\n    name: 'Claude Sonnet 4',\n    provider: 'anthropic',\n    inputPricePerMillion: 3,\n    outputPricePerMillion: 15,\n    contextWindow: 200000,\n    maxOutput: 64000,\n  },\n  {\n    id: 'claude-3-5-haiku-20241022',\n    name: 'Claude 3.5 Haiku',\n    provider: 'anthropic',\n    inputPricePerMillion: 0.25,\n    outputPricePerMillion: 1.25,\n    contextWindow: 200000,\n    maxOutput: 8192,\n  },\n  // OpenAI\n  {\n    id: 'gpt-4o',\n    name: 'GPT-4o',\n    provider: 'openai',\n    inputPricePerMillion: 5,\n    outputPricePerMillion: 15,\n    contextWindow: 128000,\n    maxOutput: 16384,\n  },\n  {\n    id: 'gpt-4-turbo',\n    name: 'GPT-4 Turbo',\n    provider: 'openai',\n    inputPricePerMillion: 10,\n    outputPricePerMillion: 30,\n    contextWindow: 128000,\n    maxOutput: 4096,\n  },\n  {\n    id: 'gpt-3.5-turbo',\n    name: 'GPT-3.5 Turbo',\n    provider: 'openai',\n    inputPricePerMillion: 0.5,\n    outputPricePerMillion: 1.5,\n    contextWindow: 16385,\n    maxOutput: 4096,\n  },\n  // Google\n  {\n    id: 'gemini-1.5-pro',\n    name: 'Gemini 1.5 Pro',\n    provider: 'google',\n    inputPricePerMillion: 3.5,\n    outputPricePerMillion: 10.5,\n    contextWindow: 1000000,\n    maxOutput: 8192,\n  },\n  {\n    id: 'gemini-1.5-flash',\n    name: 'Gemini 1.5 Flash',\n    provider: 'google',\n    inputPricePerMillion: 0.075,\n    outputPricePerMillion: 0.3,\n    contextWindow: 1000000,\n    maxOutput: 8192,\n  },\n];\n\n// ============================================\n// Token Estimation\n// ============================================\n\n/**\n * Estimate token count for text\n * Uses ~4 characters per token for English (approximation)\n * More accurate estimation would use a proper tokenizer\n */\nexport function estimateTokens(text: string): number {\n  if (!text) return 0;\n\n  // Count words, punctuation, and whitespace separately\n  const words = text.split(/\\s+/).filter(Boolean).length;\n  const punctuation = (text.match(/[.,!?;:'\"()\\[\\]{}]/g) || []).length;\n  const numbers = (text.match(/\\d+/g) || []).length;\n\n  // Rough estimation: ~1.3 tokens per word on average\n  // Punctuation is usually 1 token each\n  // Numbers can vary\n  return Math.ceil(words * 1.3 + punctuation + numbers * 0.5);\n}\n\n/**\n * More accurate token estimation using byte-pair encoding approximation\n */\nexport function estimateTokensAccurate(text: string): number {\n  if (!text) return 0;\n\n  // Split into \"token-like\" units\n  const tokenPattern = /[\\w]+|[^\\w\\s]|\\s+/g;\n  const matches = text.match(tokenPattern) || [];\n\n  let tokens = 0;\n  for (const match of matches) {\n    if (/^\\s+$/.test(match)) {\n      // Whitespace\n      tokens += Math.ceil(match.length / 4);\n    } else if (/^[\\w]+$/.test(match)) {\n      // Words - estimate based on length\n      if (match.length <= 4) {\n        tokens += 1;\n      } else if (match.length <= 8) {\n        tokens += 2;\n      } else {\n        tokens += Math.ceil(match.length / 4);\n      }\n    } else {\n      // Punctuation/special chars\n      tokens += 1;\n    }\n  }\n\n  return tokens;\n}\n\n// ============================================\n// Cost Calculation\n// ============================================\n\nexport interface CostEstimate {\n  inputTokens: number;\n  outputTokens: number;\n  inputCost: number;\n  outputCost: number;\n  totalCost: number;\n  model: ModelPricing;\n}\n\n/**\n * Calculate cost for a single execution\n */\nexport function calculateCost(\n  inputText: string,\n  estimatedOutputTokens: number,\n  modelId: string\n): CostEstimate {\n  const model = MODEL_PRICING.find((m) => m.id === modelId);\n  if (!model) {\n    throw new Error(`Unknown model: ${modelId}`);\n  }\n\n  const inputTokens = estimateTokensAccurate(inputText);\n  const outputTokens = Math.min(estimatedOutputTokens, model.maxOutput);\n\n  const inputCost = (inputTokens * model.inputPricePerMillion) / 1_000_000;\n  const outputCost = (outputTokens * model.outputPricePerMillion) / 1_000_000;\n\n  return {\n    inputTokens,\n    outputTokens,\n    inputCost,\n    outputCost,\n    totalCost: inputCost + outputCost,\n    model,\n  };\n}\n\n/**\n * Calculate batch cost\n */\nexport function calculateBatchCost(\n  prompts: string[],\n  avgOutputTokens: number,\n  modelId: string\n): {\n  estimates: CostEstimate[];\n  totalCost: number;\n  avgCostPerPrompt: number;\n} {\n  const estimates = prompts.map((p) =>\n    calculateCost(p, avgOutputTokens, modelId)\n  );\n\n  const totalCost = estimates.reduce((sum, e) => sum + e.totalCost, 0);\n\n  return {\n    estimates,\n    totalCost,\n    avgCostPerPrompt: totalCost / prompts.length,\n  };\n}\n\n/**\n * Project monthly cost based on usage\n */\nexport function projectMonthlyCost(\n  dailyExecutions: number,\n  avgInputTokens: number,\n  avgOutputTokens: number,\n  modelId: string\n): {\n  daily: number;\n  weekly: number;\n  monthly: number;\n  yearly: number;\n} {\n  const model = MODEL_PRICING.find((m) => m.id === modelId);\n  if (!model) {\n    throw new Error(`Unknown model: ${modelId}`);\n  }\n\n  const costPerExecution =\n    (avgInputTokens * model.inputPricePerMillion) / 1_000_000 +\n    (avgOutputTokens * model.outputPricePerMillion) / 1_000_000;\n\n  const daily = dailyExecutions * costPerExecution;\n\n  return {\n    daily,\n    weekly: daily * 7,\n    monthly: daily * 30,\n    yearly: daily * 365,\n  };\n}\n\n// ============================================\n// Cost Optimization\n// ============================================\n\nexport interface OptimizationSuggestion {\n  type: 'model_switch' | 'prompt_compression' | 'caching' | 'batching';\n  description: string;\n  currentCost: number;\n  projectedCost: number;\n  savings: number;\n  savingsPercent: number;\n  recommendation: string;\n}\n\n/**\n * Get cost optimization suggestions\n */\nexport function getOptimizationSuggestions(\n  inputText: string,\n  outputTokens: number,\n  currentModelId: string,\n  monthlyExecutions: number\n): OptimizationSuggestion[] {\n  const suggestions: OptimizationSuggestion[] = [];\n  const currentEstimate = calculateCost(inputText, outputTokens, currentModelId);\n  const monthlyCurrentCost = currentEstimate.totalCost * monthlyExecutions;\n\n  // Check for cheaper model alternatives\n  const currentModel = MODEL_PRICING.find((m) => m.id === currentModelId)!;\n\n  for (const altModel of MODEL_PRICING) {\n    if (altModel.id === currentModelId) continue;\n    if (altModel.contextWindow < currentEstimate.inputTokens) continue;\n\n    const altEstimate = calculateCost(inputText, outputTokens, altModel.id);\n    const monthlyAltCost = altEstimate.totalCost * monthlyExecutions;\n    const savings = monthlyCurrentCost - monthlyAltCost;\n\n    if (savings > 0) {\n      suggestions.push({\n        type: 'model_switch',\n        description: `Switch from ${currentModel.name} to ${altModel.name}`,\n        currentCost: monthlyCurrentCost,\n        projectedCost: monthlyAltCost,\n        savings,\n        savingsPercent: (savings / monthlyCurrentCost) * 100,\n        recommendation: `Consider using ${altModel.name} for simpler tasks to save $${savings.toFixed(2)}/month`,\n      });\n    }\n  }\n\n  // Prompt compression suggestion if prompt is long\n  if (currentEstimate.inputTokens > 1000) {\n    const compressionSavings = monthlyCurrentCost * 0.2; // Assume 20% reduction\n    suggestions.push({\n      type: 'prompt_compression',\n      description: 'Optimize prompt to reduce token usage',\n      currentCost: monthlyCurrentCost,\n      projectedCost: monthlyCurrentCost * 0.8,\n      savings: compressionSavings,\n      savingsPercent: 20,\n      recommendation: 'Your prompt is lengthy. Consider removing redundant instructions or using prompt compression.',\n    });\n  }\n\n  // Caching suggestion for repetitive prompts\n  if (monthlyExecutions > 100) {\n    const cacheSavings = monthlyCurrentCost * 0.3; // Assume 30% cache hit rate\n    suggestions.push({\n      type: 'caching',\n      description: 'Enable response caching for repeated queries',\n      currentCost: monthlyCurrentCost,\n      projectedCost: monthlyCurrentCost * 0.7,\n      savings: cacheSavings,\n      savingsPercent: 30,\n      recommendation: 'With high volume, caching similar queries could reduce costs significantly.',\n    });\n  }\n\n  // Sort by savings\n  suggestions.sort((a, b) => b.savings - a.savings);\n\n  return suggestions;\n}\n\n// ============================================\n// Budget Tracking\n// ============================================\n\nexport interface BudgetConfig {\n  monthlyLimit: number;\n  warningThreshold: number; // Percentage (0-1)\n  alertThreshold: number;\n}\n\nexport interface BudgetStatus {\n  spent: number;\n  remaining: number;\n  percentUsed: number;\n  status: 'ok' | 'warning' | 'alert' | 'exceeded';\n  projectedEndOfMonth: number;\n  daysRemaining: number;\n}\n\n/**\n * Check budget status\n */\nexport function checkBudgetStatus(\n  config: BudgetConfig,\n  currentSpend: number,\n  dailyAvgSpend: number\n): BudgetStatus {\n  const today = new Date();\n  const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);\n  const daysRemaining = Math.ceil(\n    (endOfMonth.getTime() - today.getTime()) / (1000 * 60 * 60 * 24)\n  );\n\n  const projectedEndOfMonth = currentSpend + dailyAvgSpend * daysRemaining;\n  const percentUsed = currentSpend / config.monthlyLimit;\n\n  let status: BudgetStatus['status'] = 'ok';\n  if (currentSpend >= config.monthlyLimit) {\n    status = 'exceeded';\n  } else if (percentUsed >= config.alertThreshold) {\n    status = 'alert';\n  } else if (percentUsed >= config.warningThreshold) {\n    status = 'warning';\n  }\n\n  return {\n    spent: currentSpend,\n    remaining: Math.max(0, config.monthlyLimit - currentSpend),\n    percentUsed: percentUsed * 100,\n    status,\n    projectedEndOfMonth,\n    daysRemaining,\n  };\n}\n\n// ============================================\n// Format Helpers\n// ============================================\n\nexport function formatCost(amount: number): string {\n  if (amount < 0.01) {\n    return `$${(amount * 100).toFixed(3)}¢`;\n  }\n  return `$${amount.toFixed(4)}`;\n}\n\nexport function formatTokens(count: number): string {\n  if (count >= 1_000_000) {\n    return `${(count / 1_000_000).toFixed(1)}M`;\n  }\n  if (count >= 1_000) {\n    return `${(count / 1_000).toFixed(1)}K`;\n  }\n  return count.toString();\n}\n\n// ============================================\n// Cost Comparison\n// ============================================\n\nexport interface ModelComparison {\n  model: ModelPricing;\n  inputCost: number;\n  outputCost: number;\n  totalCost: number;\n  relativeCost: number; // 1.0 = cheapest\n}\n\n/**\n * Compare costs across all models\n */\nexport function compareModels(\n  inputTokens: number,\n  outputTokens: number\n): ModelComparison[] {\n  const comparisons: ModelComparison[] = MODEL_PRICING.map((model) => {\n    const inputCost = (inputTokens * model.inputPricePerMillion) / 1_000_000;\n    const outputCost = (outputTokens * model.outputPricePerMillion) / 1_000_000;\n\n    return {\n      model,\n      inputCost,\n      outputCost,\n      totalCost: inputCost + outputCost,\n      relativeCost: 0, // Will calculate below\n    };\n  });\n\n  // Calculate relative cost\n  const minCost = Math.min(...comparisons.map((c) => c.totalCost));\n  for (const comparison of comparisons) {\n    comparison.relativeCost = comparison.totalCost / minCost;\n  }\n\n  // Sort by total cost\n  comparisons.sort((a, b) => a.totalCost - b.totalCost);\n\n  return comparisons;\n}\n","'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Icons } from './Icons';\n\ninterface Message {\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: Date;\n}\n\ninterface AIAgentHelperProps {\n  isOpen: boolean;\n  onClose: () => void;\n  currentPrompt?: string;\n  targetLLM?: string;\n}\n\nexport default function AIAgentHelper({\n  isOpen,\n  onClose,\n  currentPrompt,\n  targetLLM,\n}: AIAgentHelperProps) {\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      role: 'assistant',\n      content: \"Hi! I'm your PromptForge Assistant. I can help you improve your prompts, explain concepts, or suggest better approaches. What would you like help with?\",\n      timestamp: new Date(),\n    },\n  ]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  // Load messages from localStorage\n  useEffect(() => {\n    const saved = localStorage.getItem('promptforge-agent-messages');\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved);\n        setMessages(parsed.map((m: Message) => ({ ...m, timestamp: new Date(m.timestamp) })));\n      } catch {\n        // Ignore parse errors\n      }\n    }\n  }, []);\n\n  // Save messages to localStorage\n  useEffect(() => {\n    if (messages.length > 1) {\n      localStorage.setItem('promptforge-agent-messages', JSON.stringify(messages.slice(-20)));\n    }\n  }, [messages]);\n\n  const handleSend = async () => {\n    if (!input.trim() || isLoading) return;\n\n    const userMessage: Message = {\n      role: 'user',\n      content: input,\n      timestamp: new Date(),\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setInput('');\n    setIsLoading(true);\n\n    try {\n      const response = await fetch('/api/ai/agent', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          messages: [...messages, userMessage].map(m => ({\n            role: m.role,\n            content: m.content,\n          })),\n          currentPrompt,\n          targetLLM,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to get response');\n      }\n\n      const data = await response.json();\n\n      const assistantMessage: Message = {\n        role: 'assistant',\n        content: data.response,\n        timestamp: new Date(),\n      };\n\n      setMessages(prev => [...prev, assistantMessage]);\n    } catch {\n      const errorMessage: Message = {\n        role: 'assistant',\n        content: \"I'm sorry, I encountered an error. Please try again.\",\n        timestamp: new Date(),\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const quickActions = [\n    { label: 'Improve my prompt', action: 'Can you suggest improvements for my current prompt?' },\n    { label: 'Add examples', action: 'Help me add few-shot examples to my prompt' },\n    { label: 'Make it clearer', action: 'How can I make my prompt clearer and more specific?' },\n    { label: 'Best practices', action: 'What are the best practices for prompt engineering?' },\n  ];\n\n  const handleClearChat = () => {\n    setMessages([{\n      role: 'assistant',\n      content: \"Chat cleared! How can I help you with your prompts?\",\n      timestamp: new Date(),\n    }]);\n    localStorage.removeItem('promptforge-agent-messages');\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed right-0 top-0 h-full w-96 bg-[#0f2137] border-l border-[#1e3a5f] shadow-2xl z-50 flex flex-col\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b border-[#1e3a5f]\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-[#4ECDC4] to-[#3EB489] flex items-center justify-center\">\n            <Icons.bot className=\"w-6 h-6 text-[#0a1929]\" />\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-white\">AI Assistant</h3>\n            <p className=\"text-xs text-[#64748b]\">Prompt engineering help</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <button\n            onClick={handleClearChat}\n            className=\"p-2 text-[#64748b] hover:text-white transition-colors\"\n            title=\"Clear chat\"\n          >\n            <Icons.trash className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={onClose}\n            className=\"p-2 text-[#64748b] hover:text-white transition-colors\"\n          >\n            <Icons.close className=\"w-5 h-5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {messages.map((message, index) => (\n          <div\n            key={index}\n            className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n          >\n            <div\n              className={`max-w-[85%] rounded-2xl px-4 py-2.5 ${\n                message.role === 'user'\n                  ? 'bg-[#4ECDC4] text-[#0a1929]'\n                  : 'bg-[#1e3a5f] text-white'\n              }`}\n            >\n              <div className=\"text-sm whitespace-pre-wrap\">{message.content}</div>\n              <div\n                className={`text-xs mt-1 ${\n                  message.role === 'user' ? 'text-[#0a1929]/60' : 'text-[#64748b]'\n                }`}\n              >\n                {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n              </div>\n            </div>\n          </div>\n        ))}\n\n        {isLoading && (\n          <div className=\"flex justify-start\">\n            <div className=\"bg-[#1e3a5f] rounded-2xl px-4 py-3\">\n              <div className=\"flex gap-1\">\n                <div className=\"w-2 h-2 rounded-full bg-[#4ECDC4] animate-bounce\" style={{ animationDelay: '0s' }} />\n                <div className=\"w-2 h-2 rounded-full bg-[#4ECDC4] animate-bounce\" style={{ animationDelay: '0.2s' }} />\n                <div className=\"w-2 h-2 rounded-full bg-[#4ECDC4] animate-bounce\" style={{ animationDelay: '0.4s' }} />\n              </div>\n            </div>\n          </div>\n        )}\n\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"px-4 pb-2\">\n        <div className=\"flex flex-wrap gap-1\">\n          {quickActions.map((action, i) => (\n            <button\n              key={i}\n              onClick={() => {\n                setInput(action.action);\n              }}\n              className=\"text-xs px-2 py-1 rounded-full bg-[#1e3a5f] text-[#94a3b8] hover:text-white hover:bg-[#2d4a6f] transition-colors\"\n            >\n              {action.label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Input */}\n      <div className=\"p-4 border-t border-[#1e3a5f]\">\n        <div className=\"flex gap-2\">\n          <input\n            type=\"text\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && handleSend()}\n            placeholder=\"Ask me anything...\"\n            className=\"flex-1 px-4 py-2.5 bg-[#0a1929] border border-[#1e3a5f] rounded-xl text-white placeholder-[#64748b] focus:border-[#4ECDC4] focus:outline-none\"\n          />\n          <button\n            onClick={handleSend}\n            disabled={isLoading || !input.trim()}\n            className={`p-2.5 rounded-xl transition-colors ${\n              isLoading || !input.trim()\n                ? 'bg-[#1e3a5f] text-[#64748b] cursor-not-allowed'\n                : 'bg-[#4ECDC4] text-[#0a1929] hover:bg-[#c49843]'\n            }`}\n          >\n            <Icons.send className=\"w-5 h-5\" />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}